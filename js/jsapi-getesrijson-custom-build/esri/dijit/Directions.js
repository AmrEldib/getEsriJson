//>>built
require({cache:{"url:esri/dijit/templates/Directions.html":'\x3cdiv class\x3d"${options.theme}" role\x3d"presentation"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"_widgetContainer" class\x3d"${_css.widgetContainerClass}" role\x3d"presentation"\x3e\r\n        \x3cdiv class\x3d"${_css.stopsContainerClass}" role\x3d"presentation"\x3e\r\n            \x3cdiv id\x3d"search-source-container" class\x3d"${_css.searchSourceContainerClass}" data-dojo-attach-point\x3d"_searchSourceContainerNode"\x3e\r\n                \x3cdiv data-dojo-attach-point\x3d"_searchSourceSelectorContainer"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsTableContainerClass}"\x3e\r\n                \x3ctable class\x3d"${_css.stopsClass}" data-dojo-attach-point\x3d"_dndNode"\x3e\x3c/table\x3e\r\n                \x3cdiv class\x3d"${_css.stopsTableCoverClass}" data-dojo-attach-point\x3d"_stopsTableCover"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsButtonContainerClass}"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsAddDestinationClass}"\x3e\r\n                    \x3cdiv tabindex\x3d"0" role\x3d"button" data-dojo-attach-point\x3d"_activateButtonNode" title\x3d"${_i18n.widgets.directions.activate}" class\x3d"${_css.activateButtonClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsPressedButtonClass}"\x3e\x3c/div\x3e\r\n                    \x3cdiv role\x3d"button" tabindex\x3d"0" class\x3d"${_css.linkButtonClass} ${_css.stopsAddDestinationBtnClass}" data-dojo-attach-point\x3d"_addDestinationNode"\x3e${_i18n.widgets.directions.addDestination}\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.travelModesContainerClass}" data-dojo-attach-point\x3d"_travelModeContainerNode"\x3e\r\n                    \x3cdiv data-dojo-attach-point\x3d"_travelModeSelectorContainer"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsOptionsButtonClass}" data-dojo-attach-point\x3d"_optionsButtonNode"\x3e${_i18n.widgets.directions.showOptions}\x3c/div\x3e\r\n            \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv role\x3d"presentation" class\x3d"${_css.stopsOptionsMenuClass}" data-dojo-attach-point\x3d"_optionsMenuNode"\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsCheckboxesClass}"\x3e\r\n                    \x3cul\x3e\r\n                        \x3cli class\x3d"${_css.stopsFindOptimalOrderClass}" data-dojo-attach-point\x3d"_findOptimalOrderItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_findOptimalOrderNode" type\x3d"checkbox" id\x3d"${id}_find_optimal_order" /\x3e\x3clabel for\x3d"${id}_find_optimal_order"\x3e${_i18n.widgets.directions.findOptimalOrder}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsReturnToStartClass}" data-dojo-attach-point\x3d"_returnToStartItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_returnToStartNode" type\x3d"checkbox" id\x3d"${id}_stopsReturnToStart" /\x3e\x3clabel for\x3d"${id}_stopsReturnToStart"\x3e${_i18n.widgets.directions.returnToStart}\x3c/label\x3e\x3c/li\x3e\r\n                        \x3cli class\x3d"${_css.stopsUseTrafficClass}" data-dojo-attach-point\x3d"_useTrafficItemNode"\x3e\x3cinput tabindex\x3d"0" data-dojo-attach-point\x3d"_useTrafficNode" type\x3d"checkbox" id\x3d"${id}_stopsUseTraffic" /\x3e\x3clabel for\x3d"${id}_stopsUseTraffic"\x3e${_i18n.widgets.directions.useTraffic}\x3c/label\x3e\x3c/li\x3e\r\n                    \x3c/ul\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.stopsOptionsToggleContainerClass}"\x3e\r\n                    \x3cdiv class\x3d"${_css.stopsOptionsUnitsContainerClass}"  data-dojo-attach-point\x3d"_agolDistanceUnitsNode"\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsMiClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass}" data-dojo-attach-point\x3d"_useMilesNode"\x3e${_i18n.widgets.directions.units.MILES.abbr}\x3c/div\x3e\r\n                        \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsOptionsUnitsKmClass} ${_css.stopsButtonClass} ${_css.stopsButtonTabClass} ${_css.stopsButtonTabLastClass} ${_css.stopsPressedButtonClass}" data-dojo-attach-point\x3d"_useKilometersNode"\x3e${_i18n.widgets.directions.units.KILOMETERS.abbr}\x3c/div\x3e\r\n                        \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                    \x3c/div\x3e\r\n                    \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n                \x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n            \x3cdiv class\x3d"${_css.stopsGetDirectionsContainerClass}"\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.stopsButtonClass} ${_css.stopsGetDirectionsClass}" data-dojo-attach-point\x3d"_getDirectionsButtonNode"\x3e${_i18n.widgets.directions.getDirections}\x3c/div\x3e\r\n                \x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"${_css.linkButtonClass} ${_css.stopsClearDirectionsClass}" data-dojo-attach-point\x3d"_clearDirectionsButtonNode"\x3e${_i18n.widgets.directions.clearDirections}\x3c/div\x3e\r\n                \x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n            \x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.clearClass}"\x3e\x3c/div\x3e\r\n    \t\x3cdiv data-dojo-attach-point\x3d"_errorNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3cdiv class\x3d"${_css.resultsContainerClass}" role\x3d"presentation"\x3e\r\n        \t\x3cdiv class\x3d"${_css.routesContainerClass}" data-dojo-attach-point\x3d"_resultsNode" role\x3d"presentation"\x3e\x3c/div\x3e\r\n    \t\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/Directions","require dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/array dojo/_base/Color dijit/a11yclick dijit/_TemplatedMixin dijit/form/Select dojo/store/Memory dojo/data/ObjectStore dojo/keys dojo/has dojo/on dojo/mouse dojo/dom dojo/dom-geometry dojo/dom-style dojo/dom-class dojo/dom-attr dojo/query dojo/number dojo/i18n!../nls/jsapi dojo/text!./templates/Directions.html ./Search dojo/dom-construct dojo/promise/all dojo/Deferred dojo/dnd/Source ../kernel ../graphic ../units ../InfoTemplate ../SpatialReference ../layers/ArcGISDynamicMapServiceLayer ../layers/GraphicsLayer ../geometry/webMercatorUtils ../geometry/geodesicUtils ../arcgis/utils ../geometry/Point ../geometry/Extent ../geometry/Polyline ../geometry/mathUtils ../symbols/SimpleMarkerSymbol ../symbols/PictureMarkerSymbol ../symbols/CartographicLineSymbol ../symbols/TextSymbol ../symbols/Font ./_EventedWidget ../tasks/FeatureSet ../tasks/RouteTask ../tasks/RouteParameters ../tasks/GeometryService ../tasks/DistanceParameters ../tasks/PrintTask ../tasks/PrintParameters ../tasks/PrintTemplate ../toolbars/edit ../config ../tasks/ProjectParameters dojo/uacss".split(" "),
function(z,K,f,S,w,I,A,Y,T,Z,$,F,aa,k,G,U,ba,x,r,y,C,L,l,ca,V,t,H,p,da,ea,s,u,M,fa,ga,P,J,ha,ia,N,ja,Q,va,W,D,E,ka,O,la,ma,na,oa,R,pa,qa,ra,sa,X,ta,ua){K=K("esri.dijit.Directions",[la,Y],{templateString:ca,mapClickActive:!1,_eventMap:{activate:!0,deactivate:!1,load:!0,"directions-start":!0,"directions-finish":["result"],"directions-clear":!0,"segment-select":["graphic"],"segment-highlight":["graphic"],error:["error"],"stops-update":["stops"]},_emptyStop:{name:""},constructor:function(a,b){if(!a.map)throw Error('Required "map" parameter is missing. Cannot instantiate Directions Widget.');
if(!b)throw Error('Required "srcNodeRef" parameter is missing. Cannot instantiate Directions Widget.');this._i18n=l;this._css={widgetContainerClass:"esriDirectionsContainer",searchSourceContainerClass:"esriSearchSourceContainer",stopsContainerClass:"esriStopsContainer",stopsTableContainerClass:"esriStopsTableContainer",stopsTableCoverClass:"esriStopsTableCover",reverseStopsClass:"esriStopsReverse",addStopsClass:"esriStopsAdd",stopsClass:"esriStops",stopsRemovableClass:"esriStopsRemovable",stopsButtonContainerClass:"esriStopsButtons",
stopsOptionsButtonClass:"esriStopsOptionsButton",stopsAddDestinationClass:"esriStopsAddDestination",stopsAddDestinationBtnClass:"esriStopsAddDestinationBtn",stopsGetDirectionsContainerClass:"esriStopsGetDirectionsContainer",stopsGetDirectionsClass:"esriStopsGetDirections",stopsClearDirectionsClass:"esriStopsClearDirections",stopsInnerGeocoderClass:"esriInnerGeocoder",stopsOptionsOptionsEnabledClass:"esriStopsOptionsEnabled",stopsOptionsMenuClass:"esriStopsOptionsMenu",stopsFindOptimalOrderClass:"esriFindOptimalOrderOption",
stopsUseTrafficClass:"esriUseTrafficOption",stopsReturnToStartClass:"esriReturnToStartOption",stopsOptionsCheckboxesClass:"esriOptionsCheckboxes",stopsOptionsToggleContainerClass:"esriOptionsToggleContainer",stopsOptionsUnitsContainerClass:"esriOptionsUnitsContainer",stopsOptionsUnitsMiClass:"esriOptionsUnitsMi",stopsOptionsUnitsKmClass:"esriOptionsUnitsKm",stopsOptionsImpedanceContainerClass:"esriOptionsImpedanceContainer",stopsOptionsImpedanceTimeClass:"esriOptionsImpedanceTime",stopsOptionsImpedanceDistanceClass:"esriOptionsImpedanceDistance",
stopClass:"esriStop",stopOriginClass:"esriStopOrigin",stopDestinationClass:"esriStopDestination",stopUnreachedFirstOrLastClass:"esriStopUnreachedFirstOrLast",stopUnreachedClass:"esriStopUnreached",esriStopGeocoderColumnClass:"esriStopGeocoderColumn",esriStopReverseColumnClass:"esriStopReverseColumn",stopDnDHandleClass:"esriStopDnDHandle",stopDnDHandleClassHidden:"esriStopDnDHandleHidden",stopIconColumnClass:"esriStopIconColumn",stopIconClass:"esriStopIcon",stopIconRemoveColumnClass:"esriStopIconRemoveColumn",
stopIconRemoveClass:"esriStopIconRemove",stopIconRemoveClassHidden:"esriStopIconRemoveHidden",resultsContainerClass:"esriResultsContainer",resultsLoadingClass:"esriResultsLoading",resultsPrintClass:"esriResultsPrint",resultsSummaryClass:"esriResultsSummary",resultsViewFullRouteClass:"esriResultsViewFullRoute",resultsRouteNameClass:"esriResultsRouteName",resultsRouteButtonContainerClass:"esriResultsButtonsContainer",routesContainerClass:"esriRoutesContainer",routesClass:"esriRoutes",routesErrorClass:"esriRoutesError",
routeClass:"esriRoute",routeTextColumnClass:"esriRouteTextColumn",routeTextClass:"esriRouteText",routeLengthClass:"esriRouteLength",routeOriginClass:"esriDMTStopOrigin",routeDestinationClass:"esriDMTStopDestination",routeLastClass:"esriDMTStopLast",routeInfoClass:"esriRouteInfo",routeIconColumnClass:"esriRouteIconColumn",routeIconClass:"esriRouteIcon",infoWindowRouteClass:"esriInfoWindowRoute",routeZoomClass:"esriRouteZoom",esriPrintPageClass:"esriPrintPage",esriPrintBarClass:"esriPrintBar",esriPrintButtonClass:"esriPrintButton",
esriCloseButtonClass:"esriCloseButton",esriPrintMainClass:"esriPrintMain",esriPrintHeaderClass:"esriPrintHeader",esriPrintLogoClass:"esriPrintLogo",esriPrintMapClass:"esriPrintMap",esriPrintNameClass:"esriPrintName",esriPrintNotesClass:"esriPrintNotes",esriPrintLengthClass:"esriPrintLength",esriPrintDirectionsClass:"esriPrintDirections",esriPrintFooterClass:"esriPrintFooter",esriPrintStopLabelClass:"esriPrintStopLabel",clearClass:"esriClear",dndDragBodyClass:"esriDndDragDirection",stopsButtonClass:"esriDirectionsButton",
stopsButtonTabClass:"esriDirectionsTabButton",stopsButtonTabLastClass:"esriDirectionsTabLastButton",stopsPressedButtonClass:"esriDirectionsPressedButton",linkButtonClass:"esriLinkButton",activateButtonClass:"esriActivateButton",travelModesContainerClass:"esriTravelModesContainer"};this.options={map:null,autoSolve:!0,minStops:2,maxStops:20,theme:"simpleDirections",alphabet:"1234567890",directions:null,returnToStart:!1,optimalRoute:!1,routeTaskUrl:location.protocol+"//route.arcgis.com/arcgis/rest/services/World/Route/NAServer/Route_World",
printTaskUrl:location.protocol+"//utility.arcgisonline.com/arcgis/rest/services/Utilities/PrintingTools/GPServer/Export%20Web%20Map%20Task",geometryTaskUrl:location.protocol+"//utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer",routeParams:{},stops:["",""],searchOptions:{},stopsInfoTemplate:new M(l.widgets.directions.stop,"${address}${error}"),waypointInfoTemplate:new M(l.widgets.directions.maneuver,l.widgets.directions.waypoint),segmentInfoTemplate:new M(l.widgets.directions.maneuver,
'\x3cdiv class\x3d"${maneuverType}"\x3e\x3cdiv class\x3d"'+this._css.routeIconClass+" "+this._css.infoWindowRouteClass+'"\x3e\x3cstrong\x3e${step}.\x3c/strong\x3e ${formattedText}\x3c/div\x3e\x3c/div\x3e'),textSymbolFont:new O("11px",O.STYLE_NORMAL,O.VARIANT_NORMAL,O.WEIGHT_NORMAL,"Arial, Helvetica, sans-serif"),textSymbolColor:new I([255,255,255]),textSymbolOffset:{x:0,y:10.875},fromSymbol:(new D({url:z.toUrl("./images/Directions/greenPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,
10.875),fromSymbolDrag:(new D({url:z.toUrl("./images/Directions/greenPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbol:(new D({url:z.toUrl("./images/Directions/bluePoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),stopSymbolDrag:(new D({url:z.toUrl("./images/Directions/bluePointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),toSymbol:(new D({url:z.toUrl("./images/Directions/redPoint.png"),height:21.75,width:15.75,
type:"esriPMS"})).setOffset(0,10.875),toSymbolDrag:(new D({url:z.toUrl("./images/Directions/redPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbol:(new D({url:z.toUrl("./images/Directions/grayPoint.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),unreachedSymbolDrag:(new D({url:z.toUrl("./images/Directions/grayPointMove.png"),height:21.75,width:15.75,type:"esriPMS"})).setOffset(0,10.875),waypointSymbol:new W({color:[255,255,255,255],size:10,
type:"esriSMS",style:"esriSMSCircle",outline:{color:[20,89,127,255],width:2.5,type:"esriSLS",style:"esriSLSSolid"}}),maneuverSymbol:new W({color:[255,255,255,255],size:4,type:"esriSMS",style:"esriSMSCircle",outline:{color:[30,99,137,255],width:1,type:"esriSLS",style:"esriSLSSolid"}}),routeSymbol:(new E).setColor(new I([20,89,127,1])).setWidth(10).setCap(E.CAP_ROUND).setJoin(E.JOIN_ROUND),segmentSymbol:(new E).setColor(new I([255,255,255,1])).setWidth(6).setCap(E.CAP_ROUND).setJoin(E.JOIN_ROUND),printPage:"",
printTemplate:"",focusOnNewStop:!0,dragging:!0,canModifyStops:!0,canModifyWaypoints:!0,directionsLengthUnits:null,directionsLanguage:null,traffic:!1,trafficLayer:null,showPrintPage:!0,showSegmentPopup:!1,showSegmentHighlight:!0,showReverseStopsButton:!0,showReturnToStartOption:!0,showOptimalRouteOption:!0,showTravelModesOption:!0,showMilesKilometersOption:!0,showClearButton:!1,showActivateButton:!0};this.defaults=f.mixin({},this.options,a,{_waypointName:"DWWP",_solveInProgress:!1,_moveInProgress:!1,
_stopSequence:1E3});this.domNode=b},postCreate:function(){this.inherited(arguments);this.own(k(this._activateButtonNode,A,f.hitch(this,function(){this.mapClickActive?this.deactivate():this.activate()})));this.own(k(this._addDestinationNode,A,f.hitch(this,this._addStopButton)));this.own(k(this._optionsButtonNode,A,f.hitch(this,this._toggleOptionsMenu)));this.own(k(this._findOptimalOrderNode,A,f.hitch(this,this._toggleCheckbox)));this.own(k(this._returnToStartNode,A,f.hitch(this,this._toggleCheckbox)));
this.own(k(this._useTrafficNode,A,f.hitch(this,this._toggleCheckbox)));this.own(k(this._useMilesNode,A,f.hitch(this,this._toggleUnits)));this.own(k(this._useKilometersNode,A,f.hitch(this,this._toggleUnits)));this.own(k(this._getDirectionsButtonNode,A,f.hitch(this,this.getDirections)));this.own(k(this._clearDirectionsButtonNode,A,f.hitch(this,function(){this.clearDirections()})));this._symbolEventPaddingDirections=(new E).setColor(new I([0,255,0,0])).setWidth(20).setCap(E.CAP_ROUND);this._stopLayer=
new P({id:"directions_stopLayer_"+this.id,displayOnPan:!0});this._routeLayer=new P({id:"directions_routeLayer_"+this.id,displayOnPan:!0});this._waypointsEventLayer=new P({id:"directions_waypointsEventLayer_"+this.id,displayOnPan:!0});this.map.addLayer(this._routeLayer);this.map.addLayer(this._stopLayer);this._snappingManager=this.map.enableSnapping({layerInfos:[{layer:this._waypointsEventLayer,snapToVertex:!1,snapToPoint:!0,snapToEdge:!0}],tolerance:15});this._setWidgetProperties();var a=new s(null,
this.waypointSymbol,{}),b=f.hitch(this,function(){!this._moveInProgress&&a._isShown()&&(this.editToolbar.deactivate(),this._stopLayer.remove(a),clearTimeout(a._solveTimeout),a._solveTimeout=null,a.attributes.isWaypoint=!0,a._isStopIcon&&this.stopGraphics[a._index]&&(this._stopLayer.add(this.stopGraphics[a._index]),this._stopLayer.add(this.textGraphics[a._index])));a._showTooltip()});this._handle=f.mixin(a,{_isHandle:!0,_tooltip:t.create("div",{className:this.theme+" esriDirectionsRouteTooltip",onmouseover:b},
this.map.container),_showTooltip:f.hitch(this,function(b){a._tooltip.style.display=b&&!(b instanceof MouseEvent)?"inline":"none";b&&(b="string"===typeof b?b:"\x3ctable class\x3d'esriRoutesTooltip'\x3e"+this._renderDirectionsItemTR(b)+"\x3c/table\x3e",a._tooltip.innerHTML!==b&&(a._tooltip.innerHTML=b))}),_isShown:f.hitch(this,function(){return-1<this._stopLayer.graphics.indexOf(a)}),_remove:b});this._activate(this.mapClickActive)},startup:function(){this.inherited(arguments);return this._enqueue(this._init)},
destroy:function(){this.deactivate();this.map.removeLayer(this._routeLayer);this.map.removeLayer(this._stopLayer);this.map.removeLayer(this._waypointsEventLayer);this._disconnectEvents();t.empty(this.domNode);this.inherited(arguments)},activate:function(){return this._enqueue(function(){this.set("mapClickActive",!0)})},deactivate:function(){return this._enqueue(function(){this.set("mapClickActive",!1)})},clearDirections:function(){return this._enqueue(function(){this.clearErrors();return this._clearDirections()})},
reset:function(){return this._enqueue(this._reset)},modifyStopSequence:function(a,b){return this._enqueue(function(){this._modifyStopSequence(a,b)})},onActivate:function(){},onDeactivate:function(){},onLoad:function(){},onDirectionsStart:function(){this._clearDisplayBeforeSolve();this.set("solving",!0);this._showLoadingSpinner(!0)},onDirectionsFinish:function(){this._showLoadingSpinner(!1);this.set("solving",!1)},onDirectionsClear:function(){},onSegmentSelect:function(){},onSegmentHighlight:function(){},
onStopsUpdate:function(){},onError:function(){},removeStops:function(){return this.reset()},removeStop:function(a,b,c){return this._enqueue(function(){this.clearErrors();return this._removeStop(a,b,c)})},updateStops:function(a){return this._enqueue(function(){return this._updateStops(a)})},addStops:function(a,b){return this._enqueue(function(){return this._addStops(a,b)}).then(f.hitch(this,this.zoomToFullRoute))},addStop:function(a,b){return this._enqueue(function(){return this._addStop(a,b)})},updateStop:function(a,
b,c){return this._enqueue(function(){return this._updateStop(a,b,c)})},clearErrors:function(){this.errors=[];this._errorNode&&(this._errorNode.innerHTML="")},getDirections:function(a){return this._enqueue(function(){return this._getDirections().then(f.hitch(this,function(){!0!==a&&this.zoomToFullRoute()}))})},selectSegment:function(a){if(this.directions&&this.directions.features&&!(0>a||a>=this.directions.features.length))for(var b=C("[data-segment]",this._resultsNode),c=0;c<b.length;c++){var d=parseInt(y.get(b[c],
"data-segment"),10);if(a===d&&b[c]!==this._focusedDirectionsItem){this._focusedDirectionsItem=b[c];this.centerAtSegmentStart(a);this.onSegmentSelect(this.directions.features[a]);b[c].focus();break}}},unhighlightSegment:function(a){var b=this._segmentGraphics;if(b&&(!this._focusedDirectionsItem||a)){for(a=0;a<b.length;a++)this._routeLayer.remove(b[a]);this._segmentGraphics=[]}},highlightSegment:function(a,b){if(!(this._focusedDirectionsItem&&!b||a>=this.directions.features.length)){a=a||0;var c=f.hitch(this,
function(a){var b=this.map.toMap({x:0,y:0});return this.map.toScreen(b.offset(a,0)).x}),d=f.hitch(this,function(a){for(var b=0,d=0;d<a.length;d++)for(var e=1;e<a[d].length;e++)var g=a[d][e-1],m=a[d][e],b=b+c(Math.sqrt((g[0]-m[0])*(g[0]-m[0])+(g[1]-m[1])*(g[1]-m[1])));return b}),e=f.hitch(this,function(a){var b=this.map.toMap({x:0,y:0});return this.map.toMap({x:a,y:0}).x-b.x}),g=function(a,b,d){b=Math.max(1,b);for(var e=d?a[0].length-1:0,g=0,m,h,f,n=[[a[0][d?e:0]]];d&&0<e||!d&&e<a[0].length-1;){h=
a[0][d?e-1:e];f=a[0][d?e:e+1];if(m=c(Math.sqrt((h[0]-f[0])*(h[0]-f[0])+(h[1]-f[1])*(h[1]-f[1]))))if(g+m<b)d?n[0].splice(0,0,h):n[0].push(f),g+=m;else{b=(b-g)/m;d?n[0].splice(0,0,[f[0]-(f[0]-h[0])*b,f[1]-(f[1]-h[1])*b]):n[0].push([h[0]+(f[0]-h[0])*b,h[1]+(f[1]-h[1])*b]);break}e+=d?-1:1}return 0<g+m?n:a},h=this.get("directions").features[a],m=new Q(h.geometry),n=40*Math.PI/180;f.mixin(h.attributes,{_index:a});if(a){var B=g(this.get("directions").features[a-1].geometry.paths,25,!0),q="esriDMTStop"!==
h.attributes.maneuverType?g(m.paths,25,!1):B,B=q!==B?[B[0].concat(q[0])]:q,v=(new Q(q)).getExtent();if(1<q[0].length&&15<=c(Math.max(v.getWidth(),v.getHeight()))){for(var g=15*Math.cos(n/2),d=15*Math.sin(n/2),l=q[0].length-2,k,n=q[0][l+1],v=0;0<=l&&!v;)k=q[0][l],v=c(Math.sqrt((k[0]-n[0])*(k[0]-n[0])+(k[1]-n[1])*(k[1]-n[1]))),l--;22>v&&(q=v+(22-v)/3,l=v+2*(22-v)/3,l=[k[0]+l/v*(n[0]-k[0]),k[1]+l/v*(n[1]-k[1])],k=[n[0]-q/v*(n[0]-k[0]),n[1]-q/v*(n[1]-k[1])],n=l,v=22);g/=v;q=[n[0]-(n[0]-k[0])*g,n[1]-(n[1]-
k[1])*g];k[1]!==n[1]?(g=(n[0]-k[0])/(n[1]-k[1]),k=e(d/Math.sqrt(1+g*g)),e=g*k):(k=0,e=e(d));Infinity!==Math.abs(k)&&(Infinity!==Math.abs(e)&&!isNaN(k)&&!isNaN(e))&&(B[0].push(n),B[0].push([q[0]-k,q[1]+e]),B[0].push([q[0]+k,q[1]-e]),B[0].push(n))}else B=g(B,2*d(q),!0);m.paths=B}this.unhighlightSegment(this._segmentGraphics&&this._segmentGraphics.length);e=f.clone(this.routeSymbol).setWidth(this.segmentSymbol.width).setColor(new I([parseInt(0.9*this.segmentSymbol.color.r),parseInt(0.9*this.segmentSymbol.color.g),
parseInt(0.9*this.segmentSymbol.color.b)]));this._segmentGraphics=[new s(h.geometry,e,h.attributes,this.get("segmentInfoTemplate")),new s(m,this.routeSymbol,h.attributes,this.get("segmentInfoTemplate")),new s(m,this.segmentSymbol,h.attributes,this.get("segmentInfoTemplate"))];this.get("showSegmentHighlight")&&(this._routeLayer.add(this._segmentGraphics[0]),this._routeLayer.add(this._segmentGraphics[1]),this._routeLayer.add(this._segmentGraphics[2]));h=f.hitch(this,function(a){if(0<a&&a<this.directions.features.length){a=
this.directions.features[a]._associatedFeaturesWithWaypoints;for(var b=0;b<a.length;b++)a[b]._associatedSnapFeature&&a[b]._associatedSnapFeature.getDojoShape()&&a[b]._associatedSnapFeature.getDojoShape().moveToFront()}});h(a-1);h(a);this.onSegmentHighlight(this.directions.features[a])}},zoomToSegment:function(a){var b,c=new p;this.directions&&this.directions.features?(b=Math.max(0,Math.min(this.directions.features.length-1,a||0)),this.map.setExtent(this.get("directions").features[b].geometry.getExtent(),
!0).promise.always(f.hitch(this,function(){this.highlightSegment(b);c.resolve()}))):c.reject("No directions.");return c.promise},centerAtSegmentStart:function(a){var b,c=new p;if(this.directions&&this.directions.features){b=Math.max(0,Math.min(this.directions.features.length-1,a||0));var d=this.directions.features[b];this.map.centerAt(d.geometry.getPoint(0,0)).promise.always(f.hitch(this,function(){this.highlightSegment(b,!0);this._showSegmentPopup(d,b);c.resolve()}))}else c.reject("No directions.");
return c.promise},zoomToFullRoute:function(){var a=new p;this.directions&&this.directions.features?(this._clearInfoWindow(),this.unhighlightSegment(),this.get("map").setExtent(this.get("directions").extent,!0).promise.always(a.resolve)):a.reject("No directions.");return a.promise},setListIcons:function(){var a,b=this._dnd.getAllNodes();for(a=0;a<b.length;a++){var c=C("."+this._css.stopIconClass,b[a])[0];c&&(c.innerHTML=this._getLetter(a));r.remove(b[a],this._css.stopOriginClass+" "+this._css.stopDestinationClass+
" "+this._css.stopUnreachedClass+" "+this._css.stopUnreachedFirstOrLastClass);c=this.stopGraphics&&this.stopGraphics[a]&&this.stopGraphics[a].attributes?this.stopGraphics[a].attributes.Status:void 0;c=0<c&&6>c;0===a?r.add(b[a],c?this._css.stopUnreachedFirstOrLastClass:this._css.stopOriginClass):a===b.length-1&&!this._startReturn?r.add(b[a],c?this._css.stopUnreachedFirstOrLastClass:this._css.stopDestinationClass):c&&r.add(b[a],this._css.stopUnreachedClass)}a=C("[data-reverse-td]",this._dndNode)[0];
t.destroy(a);this.get("showReverseStopsButton")&&t.create("td",{"data-reverse-td":"true",rowspan:b.length,className:this._css.esriStopReverseColumnClass,innerHTML:'\x3cdiv role\x3d"button" class\x3d"'+this._css.reverseStopsClass+'" data-reverse-stops\x3d"true" title\x3d"'+l.widgets.directions.reverseDirections+'"\x3e\x3c/div\x3e',onmouseover:function(a){a.stopPropagation()},onmouseout:function(a){a.stopPropagation()}},b[0])},addRouteSymbols:function(){if(this.stopGraphics.length){this._moveLayersToFront();
for(var a=0;a<this.stopGraphics.length;a++)if(this.stopGraphics[a]&&(!this._handle._isShown()||this._handle._isShown()&&this._handle._index!==a)){this._stopLayer.add(this.stopGraphics[a]);var b=this.stopGraphics[a].getDojoShape();b&&b.moveToFront();this._stopLayer.add(this.textGraphics[a]);(b=this.textGraphics[a].getDojoShape())&&b.moveToFront()}this._moveInProgress&&(!this._handle.attributes.isWaypoint&&this._handle.getDojoShape())&&this._handle.getDojoShape().moveToFront()}},createRouteSymbols:function(){this._clearStopGraphics();
for(var a=this.get("stops"),b=0;b<a.length;b++){var c=a[b];if(c&&c.feature){var d=c.feature.attributes,e=d?d.Status:void 0,g=this._isStopAWaypoint(c)?this.waypointSymbol:this._getStopSymbol(b,a.length+(this._startReturn?1:0),!1,e),h=null;this._isStopAWaypoint(c)||(h=new ka(this._getLetter(b),this.get("textSymbolFont"),this.get("textSymbolColor")),this.get("textSymbolOffset")&&h.setOffset(this.get("textSymbolOffset").x,this.get("textSymbolOffset").y));h=new s(c.feature.geometry,h,{address:c.name},
this.get("stopsInfoTemplate"));h._isStopLabel=!0;h._index=b;c=new s(c.feature.geometry,g,{address:c.name,Status:void 0===e?0:e,CurbApproach:d&&d.CurbApproach?d.CurbApproach:null,isWaypoint:this._isStopAWaypoint(c)},this.get(this._isStopAWaypoint(c)?"waypointInfoTemplate":"stopsInfoTemplate"));c._isStopIcon=!0;c._index=b;this.stopGraphics[b]=c;this.textGraphics[b]=h}}this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this.addRouteSymbols();this.setListIcons()},setTravelMode:function(a){return this._enqueue(function(){this.clearErrors();
this._travelModeSelector.setValue(a);return this._setTravelMode(a)})},getSupportedTravelModeNames:function(){var a=[],b=this.serviceDescription;if(b&&b.supportedTravelModes&&b.supportedTravelModes.length)for(var b=b.supportedTravelModes,c=0;c<b.length;c++)a.push(b[c].name);return a},setDirectionsLengthUnits:function(){var a=1===arguments.length?arguments[0]:this.get("directionsLengthUnits");return this._enqueue(function(){this.clearErrors();return this._setDirectionsLengthUnits(a)})},setDirectionsLanguage:function(){var a=
1===arguments.length?arguments[0]:this.get("directionsLanguage");return this._enqueue(function(){this.clearErrors();return this._setDirectionsLanguage(a)})},useMyCurrentLocation:function(a){this.clearErrors();return this._createLocateButton(this.geocoders[a],!0,!0)},_reset:function(){var a=this.mapClickActive;this._setWidgetProperties();return this._init().then(f.hitch(this,function(){this.mapClickActive=a;this._searchSourceSelector&&this._searchSourceSelector.setValue("all")}))},_activate:function(){var a=
this.get("mapClickActive"),b=f.hitch(this,function(a){for(var b=a?[this.textGraphics,this.stopGraphics,this.displayedManeuverPointGraphics,this.displayedRouteGraphics]:[this.displayedRouteGraphics,this.displayedManeuverPointGraphics,this.stopGraphics,this.textGraphics],e=0;e<b.length;e++)for(var g=b[e],h=0;h<g.length;h++){var m=g[h].getDojoShape();m&&m[a?"moveToBack":"moveToFront"].call(m)}});this._addStopOnMapClickListener&&this._addStopOnMapClickListener.remove();a?(this.map.activeDirectionsWidget&&
this.map.activeDirectionsWidget!==this&&this.map.activeDirectionsWidget.deactivate(),this.map.activeDirectionsWidget=this,this._addStopOnMapClickListener=k(this.map,"click",f.hitch(this,function(a){this.canModifyStops&&!this._solveInProgress&&(this.map.infoWindow.hide(),this.addStop(new s(a.mapPoint)))})),this.map.addLayer(this._waypointsEventLayer),this._moveLayersToFront(),r.add(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onActivate()):(this.map.removeLayer(this._waypointsEventLayer),
r.remove(this._activateButtonNode,this._css.stopsPressedButtonClass),this.onDeactivate());b(!a);this.emit("map-click-active",{mapClickActive:this.mapClickActive})},_moveLayersToFront:function(){var a=this.get("map"),b=a.graphicsLayerIds.length-1;a.reorderLayer(this._routeLayer,b);a.reorderLayer(this._waypointsEventLayer,b);a.reorderLayer(this._stopLayer,b)},_destroyGeocoders:function(){var a=this.get("geocoders");if(a&&a.length)for(var b=0;b<a.length;b++)a[b]&&a[b].destroy();this.set("geocoders",
[])},_disconnectEvents:function(){var a=this._clearDirections(!0),b;if(this._watchEvents&&this._watchEvents.length)for(b=0;b<this._watchEvents.length;b++)this._watchEvents[b].unwatch();if(this._onEvents&&this._onEvents.length)for(b=0;b<this._onEvents.length;b++)this._onEvents[b].remove();if(this._geocoderEvents)for(b=0;b<this._geocoderEvents.length;b++)this._geocoderEvents[b].value.unwatch(),this._geocoderEvents[b].select.remove(),this._geocoderEvents[b].suggest.remove();this._onEvents=[];this._watchEvents=
[];this._geocoderEvents=[];this._disconnectResults();this._destroyGeocoders();this._destroyGlobalGeocoder();this._destroyDnD();return a},_getDirections:function(){this._removeEmptyStops();var a=new p;this._getStopCount()>=this.minStops?(this.onDirectionsStart(),this.clearErrors(),this._dnd.sync(),this._sortGeocoders(),this._getCandidates(this.get("stops")).then(f.hitch(this,function(b){this.stops=b;this._setStops();var c=this._validateStops(b);c.error?(b=l.widgets.directions.error.locator,(c=this.get("geocoders")[c.index])&&
(b=l.widgets.directions.error.unknownStop.replace("\x3cname\x3e",c.get("value"))),this._resultError(b),this.set("directions",null),this._clearRouteGraphics(),a.reject(b),this.onDirectionsFinish(Error([b]))):this._configureRoute().always(f.hitch(this,function(b){a.resolve(b)}))}),f.hitch(this,function(b){this.set("directions",null);this._clearRouteGraphics();a.reject(b);this.onDirectionsFinish(b)}))):this._clearDirections(!0).always(f.hitch(this,function(){this.createRouteSymbols();a.reject(l.widgets.directions.error.notEnoughStops)}));
return a.promise},_clearDirections:function(){var a=new p;this._handle&&this._handle._remove();this.get("routeParams")&&this.get("routeParams").stops?this.get("routeParams").stops.features.length?(this.get("routeParams").stops.features=[],this.onDirectionsClear(),a.resolve()):arguments.length?a.resolve():this._reset().then(a.resolve,a.reject):a.resolve();this.set("directions",null);this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this._removeTrafficLayer();return a.promise},_setTravelMode:function(a){var b=
new p,c=this.serviceDescription,d=function(){b.resolve(a)};if(c&&c.supportedTravelModes&&c.supportedTravelModes.length){for(var e=c.supportedTravelModes,g=!1,c=0;c<e.length;c++)if(e[c].name===a){g=!0;!this.routeParams.travelMode||this.routeParams.travelMode&&this.routeParams.travelMode.name!==a?(this.routeParams.travelMode=e[c].impedanceAttributeName?e[c]:e[c].itemId,this._solveAndZoom().always(d)):b.resolve(a);this._updateTrafficCheckbox();break}g||b.reject(a)}else b.reject(a);return b.promise},
_updateTrafficCheckbox:function(){if(this.serviceDescription){for(var a=this.routeParams.travelMode,b=this.routeParams.impedanceAttribute,c=this.serviceDescription.impedance,a=a?a.impedanceAttributeName:b?b:c,b=this.serviceDescription.networkDataset.networkAttributes,c=!1,d=0;d<b.length;d++)if(b[d].name===a){c=void 0!==b[d].trafficSupport&&"esriNTSNone"!==b[d].trafficSupport||void 0===b[d].trafficSupport&&"TravelTime"===a;break}this._useTrafficNode.disabled=!c;this._useTrafficNode.checked=this._useTrafficNode.checked&&
c;c||this._removeTrafficLayer()}},_setDirectionsLengthUnits:function(a){var b=new p;r.remove(this._useMilesNode,this._css.stopsPressedButtonClass);r.remove(this._useKilometersNode,this._css.stopsPressedButtonClass);a===u.KILOMETERS?r.add(this._useKilometersNode,this._css.stopsPressedButtonClass):a===u.MILES&&r.add(this._useMilesNode,this._css.stopsPressedButtonClass);a===u.KILOMETERS||a===u.METERS||a===u.MILES||a===u.FEET||a===u.NAUTICAL_MILES?(this.directionsLengthUnits=a,b.resolve(a)):b.reject(a);
return b.promise},_setDirectionsLanguage:function(a){var b=new p;a=this._setDirectionsLanguageByLocale(a);this._solveAndZoom().always(function(){b.resolve(a)},b.reject);return b.promise},_showLoadingSpinner:function(a){void 0===a&&(a=this._requestQueueTail&&!this._requestQueueTail.isFulfilled()||this._moveInProgress);a?r.add(this._widgetContainer,this._css.resultsLoadingClass):r.remove(this._widgetContainer,this._css.resultsLoadingClass)},_enqueue:function(a){var b=new p;this._requestQueueTail||(this._requestQueueTail=
new p,this._requestQueueTail.resolve());this._requestQueueTail.promise.always(f.hitch(this,function(){try{var c=a.call(this);c&&"object"===typeof c&&c.hasOwnProperty("isFulfilled")?c.then(f.hitch(this,function(a){b.resolve(a);this._showLoadingSpinner()}),f.hitch(this,function(a){b.reject(a);this._showLoadingSpinner()})):(b.resolve(c),this._showLoadingSpinner())}catch(d){b.reject(d),this._showLoadingSpinner()}}));this._requestQueueTail=b;this._showLoadingSpinner();return b.promise},_createDnD:function(){this._dnd=
new da(this._dndNode,{skipForm:!0,withHandles:!0})},_destroyDnD:function(){t.empty(this._dndNode);this._dnd&&(this._dnd.destroy(),this._dnd=null)},_usingAGOL:function(){return-1<this.get("routeTaskUrl").search(/^(https?:)*\/\/route*[^.]*\.arcgis\.com.*$/i)},_setSearchOptions:function(){var a={map:this.get("map"),autoNavigate:!1,enableInfoWindow:!1,enableHighlight:!1,enableSourcesMenu:!1};this.searchOptions=f.mixin({maxResults:1,locationToAddressDistance:100},this.defaults.searchOptions,a)},_setDefaultUnits:function(){if(!this.get("directionsLengthUnits")){var a=
"EN-US"===S.locale.toUpperCase()?u.MILES:u.KILOMETERS;this.defaults.directionsLengthUnits&&(a=this.defaults.directionsLengthUnits);this.set("directionsLengthUnits",a)}this._setDirectionsLengthUnits(this.directionsLengthUnits)},_setTrafficOptions:function(){this.set("showTrafficOption",(this.defaults.showTrafficOption||!this.defaults.hasOwnProperty("showTrafficOption"))&&("esriNTSHistoricalAndLive"===this.serviceDescription.trafficSupport||"esriNTSHistorical"===this.serviceDescription.trafficSupport||
"esriNTSLive"===this.serviceDescription.trafficSupport));this._usingAGOL()&&this.get("showTrafficOption")&&(this.get("trafficLayer")||this.set("trafficLayer",new ga(location.protocol+"//traffic.arcgis.com/arcgis/rest/services/World/Traffic/MapServer",{opacity:0.4})));this._optionsMenu()},_updateCanModifyStops:function(a,b){!this.canModifyStops&&!this.canModifyWaypoints&&this.set("mapClickActive",!1);!b&&(this.canModifyStops&&!this.canModifyWaypoints)&&this.set("mapClickActive",!0);this._showAddDestination();
this._showMapClickActiveButton();this._stopsTableCover.style.display=this.canModifyStops?"none":"inline"},_updateCanAddWaypoints:function(a,b){!this.canModifyStops&&!this.canModifyWaypoints&&this.set("mapClickActive",!1);!b&&(!this.canModifyStops&&this.canModifyWaypoints)&&this.set("mapClickActive",!0);this._showMapClickActiveButton();this._handle._remove()},_setWidgetProperties:function(){this._disconnectEvents();this.set("loaded",!1);this.set(this.defaults);this.set("stops",[]);this._updateCanModifyStops()},
_updateStops:function(a){var b=new p;a?this.get("loaded")?this._reset().then(f.hitch(this,function(){this._addStops(a).then(b.resolve,b.reject)}),b.reject):this._addStops(a).then(b.resolve,b.reject):b.reject();return b.promise},_removeStop:function(a,b,c,d){var e=new p,g=f.hitch(this,function(a){this.stops.splice(a,1);var b=this._dnd.getAllNodes()[a],c=this.get("geocoders");c[a].destroy();c.splice(a,1);this.set("geocoders",c);this._geocoderEvents[b.id]&&(this._geocoderEvents[b.id].select.remove(),
this._geocoderEvents[b.id].suggest.remove(),this._geocoderEvents[b.id].value.unwatch());t.destroy(b);this._dnd.sync();this._stopsRemovable();this._optionsMenu();this._checkMaxStops();this.setListIcons();this._sortGeocoders()});if(0>a||a>=this.stops.length||"undefined"===a)a=this.stops.length-1;var h=!1;for(d=this.stopGraphics[a]&&this._isStopAWaypoint(this.stops[a])||d;!h;)g(a),d?h=!0:(a-=0>=a||a<this.stops.length&&this._isStopAWaypoint(this.stops[a])?0:1,h=!this._isStopAWaypoint(this.stops[a]));
for(;this.stops.length<this.minStops;)this._addStop();this._setStops();this.createRouteSymbols();c?(this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve(),this.createRouteSymbols(),e.resolve()):this._solveAndZoom(b).then(e.resolve,e.reject);return e.promise},_removeTrafficLayer:function(){var a=this.get("trafficLayer"),b=this.get("map");a&&b&&b.removeLayer(a);this._trafficLayerAdded=!1},_addStops:function(a,b){var c=new p,d=[],e=this.autoSolve;this.autoSolve=!1;void 0===b&&(b=this._getStopCount());
for(var g=0;g<Math.min(a.length,this.maxStops-this._getStopCount());g++){var h=new p;this._addStop(a[g],b+g,!0).always(h.resolve);d.push(h)}H(d).always(f.hitch(this,function(){this.autoSolve=e;this._getDirections().always(function(){c.resolve(a)})}));return c.promise},_addStop:function(a,b,c){var d=new p;this._checkMaxStops();this.maxStopsReached?(this._resultError(l.widgets.directions.error.maximumStops),d.reject(l.widgets.directions.error.maximumStops)):(void 0===a&&void 0===b&&(b=this.stops.length),
a instanceof s&&a.attributes&&a.attributes.isWaypoint&&(!b||b===this.stops.length||2>this._getStopCount())&&!c?(this._resultError(l.widgets.directions.error.waypointShouldBeInBetweenStops),d.reject(l.widgets.directions.error.waypointShouldBeInBetweenStops)):this._getCandidate(a).then(f.hitch(this,function(a){this._insertStop(a,b);this.autoSolve&&""!==a.name?this._getDirections().always(function(){d.resolve(a,b)}):d.resolve(a,b)}),f.hitch(this,function(a){d.reject(a)})));return d.promise},_removeEmptyStops:function(){for(var a=
0,b=this.stops.length-this._getWaypointCount()-this.minStops;a<this.stops.length&&0<b;)!this.stops[a]||!this.stops[a].name?(this._removeStop(a,!0,!0,!0),b--,this._moveInProgress&&(this._handle._index>=a&&this._handle._isStopIcon)&&this._handle._index--):a++},_setReverseGeocode:function(a,b,c){if(a.feature.geometry&&-1<c){var d={address:a.name};this.stopGraphics[c]&&(this.stopGraphics[c].setAttributes(d),this.stopGraphics[c].setGeometry(b));this.textGraphics[c]&&(this.textGraphics[c].setAttributes(d),
this.textGraphics[c].setGeometry(b));this.set("stopGraphics",this.stopGraphics);this.set("textGraphics",this.textGraphics);this.get("geocoders")[c]&&(d=this.get("geocoders")[c],d.value=a.name,d.inputNode.value=a.name);this.stops[c]=a;this.stops[c].feature.setGeometry(b);this._setStops();return this._enqueue(function(){return this._getDirections()})}},_insertStop:function(a,b){var c,d;if(void 0===b)for(c=0;c<this.geocoders.length;c++){if(!this.geocoders[c].get("value")){d=this.geocoders[c];break}}else c=
b,this.geocoders[c]&&!this.geocoders[c].get("value")&&(d=this.geocoders[c]);d&&(void 0===b||b===c)&&!this._isStopAWaypoint(a)?(this.stops[c]=a,d.set("value",a.name),d._stopReference=a):(void 0===b&&(b=this.geocoders.length),this._createGeocoder(a,b));this._optionsMenu()},_createGeocoder:function(a,b){var c=this._dnd.getAllNodes(),d=!1,e=!1,g=c.length;c[b]?(e=c[b],d=!0):d=e=!1;var h=f.hitch(this,function(a,b){var c=b?this._css.stopDnDHandleClass:this._css.stopDnDHandleClassHidden,d=b?this._css.stopDnDHandleClassHidden:
this._css.stopDnDHandleClass;r.replace(a.children[0],c,d);2<this.geocoders.length&&(c=b?this._css.stopIconRemoveClass:this._css.stopIconRemoveClassHidden,d=b?this._css.stopIconRemoveClassHidden:this._css.stopIconRemoveClass,r.replace(a.children[3].children[0],c,d))}),m=t.create("tr",{className:this._css.stopClass,style:this._isStopAWaypoint(a)?"display:none;":"",onmouseover:function(){h(this,!0)},onmouseout:function(){h(this,!1)}});t.create("td",{className:this._css.stopDnDHandleClassHidden+" dojoDndHandle"},
m);c=t.create("td",{className:this._css.stopIconColumnClass},m);t.create("div",{className:this._css.stopIconClass+" dojoDndHandle",innerHTML:this._getLetter(g),"data-center-at":"true"},c);g=t.create("td",{className:this._css.esriStopGeocoderColumnClass},m);g=t.create("div",{},g);c=t.create("td",{className:this._css.stopIconRemoveColumnClass},m);t.create("div",{className:this._css.stopIconRemoveClassHidden,role:"button","data-remove":"true"},c);this._dnd.insertNodes(!1,[m],d,e);this.stops.splice(b,
0,a);var d=f.mixin({},this.get("searchOptions"),{value:a.name,activeSourceIndex:this._globalGeocoder.activeSourceIndex}),n=new V(d,g);n._tr=m;n._stopReference=a;n.startup();this.geocoders.splice(b,0,n);this._geocoderEvents[m.id]={select:n.on("select-result",f.hitch(this,function(a){var b=!0;if(a&&(a.results||a.result)){var c=this._dnd.getAllNodes(),c=w.indexOf(c,m),d=a.results&&a.results.results&&a.results.results.length?a.results.results[0]:a.result;d?(n.set("value",this._decorateEmptyAGOLGeocoderResponse(d).name),
this.stops[c]=this._toPointGeometry(d),this._setStops()):(this._removeStopButton(c),this.set("directions",null),this._resultError(l.widgets.directions.error.unknownStop.replace("\x3cname\x3e",a.target.get("value"))),this._clearRouteGraphics(),b=!1);b&&this.getDirections()}})),suggest:n.on("suggest-results",function(){if(document.activeElement===this.inputNode)for(var a=C("LI[role\x3d'menuitem']",this.suggestionsNode),b=0;b<a.length;b++)y.set(a[b],"tabindex",-1);else this._hideSuggestionsMenu()}),
value:n.watch("value",f.hitch(this,function(a,b,c){this._enqueue(function(){if(c!==b&&n._stopReference&&n._stopReference.name!==c){var a=this.stops.indexOf(n._stopReference);this.stops[a]={name:c};c||(this._handle._remove(),this._removeSomeWaypoints(this._markWPsForRemovalAfterUserChangedStopSequence(a)));this._setStops();this._clearDisplayBeforeSolve();this._clearDisplayAfterSolve();this.createRouteSymbols()}})}))};this._checkMaxStops();this.setListIcons();this._stopsRemovable();this._optionsMenu();
this._sortGeocoders()},_blurGeocoders:function(){if(document.activeElement)for(var a=0;a<this.geocoders.length;a++)if(this.geocoders[a].inputNode===document.activeElement){this.geocoders[a]._hideSuggestionsMenu();this.geocoders[a].inputNode.blur();this._getStopCount()>=this.minStops&&this.getDirections(!0);break}},_decorateEmptyAGOLGeocoderResponse:function(a){a&&", , "===a.name&&(a.name=a.feature&&a.feature.attributes&&a.feature.attributes.Match_addr?a.feature.attributes.Match_addr+("POI"===a.feature.attributes.Addr_type&&
a.feature.attributes.City&&-1===a.feature.attributes.Match_addr.indexOf(a.feature.attributes.City)?", "+a.feature.attributes.City:""):"");return a},_toPointGeometry:function(a){var b=a.feature.geometry;if(b)if(b.getCentroid)a.feature.geometry=b.getCentroid();else if(b.getExtent&&(b=b.getExtent()))a.feature.geometry=b.getCenter();return a},_removeLocateButtonVisibilityEvents:function(){for(var a=0;a<this.geocoders.length;a++){var b=this.geocoders[a];b._onMouseEnter&&b._onMouseEnter.remove();b._onMouseOut&&
b._onMouseOut.remove();b._onKeyPress&&b._onKeyPress.remove();b._locateButton&&(b._locateButton._onMouseEnter&&b._locateButton._onMouseEnter.remove(),b._locateButton._onMouseOut&&b._locateButton._onMouseOut.remove())}},_setLocateButtonVisibilityEvents:function(){this._removeLocateButtonVisibilityEvents();for(var a=this,b=function(b){b instanceof FocusEvent?this._geocoder._lbShown_f=!0:this._geocoder._lbShown_g=!0;a._createLocateButton(this._geocoder,!0)},c=function(b){b instanceof FocusEvent?this._geocoder._lbShown_f=
!1:this._geocoder._lbShown_g=!1;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(f.hitch(this,function(){!this._geocoder._lbShown_lb&&!this._geocoder._lbShown_f&&a._destroyLocateButton(this._locateButton)}),400)},d=function(){this._geocoder._lbShown_g=!0;clearTimeout(this._destroyTimeout);this._destroyTimeout=setTimeout(f.hitch(this,function(){""===this.value?a._createLocateButton(this._geocoder,!0):a._destroyLocateButton(this._locateButton)}),400)},e=function(){this._geocoder._lbShown_lb=
!0;clearTimeout(this._geocoder._destroyTimeout)},g=function(){this._geocoder._lbShown_lb=!1;clearTimeout(this._geocoder._destroyTimeout);this._geocoder._destroyTimeout=setTimeout(f.hitch(this,function(){!this._geocoder._lbShown_g&&!this._geocoder._lbShown_f&&a._destroyLocateButton(this._geocoder.inputNode._locateButton)}),400)},h=0;h<this.geocoders.length;h++){var m=this.geocoders[h];m.inputNode._geocoder=m;m._onMouseEnter=k(m.inputNode,G.enter,b);m._onMouseOut=k(m.inputNode,[G.leave,"blur"],c);m._onKeyPress=
k(m.inputNode,"keydown",d);m.inputNode._locateButton&&(m=m.inputNode._locateButton,m._onMouseEnter=k(m.domNode,G.enter,e),m._onMouseOut=k(m.domNode,G.leave,g))}},_createLocateButton:function(a,b,c){var d=new p;a.inputNode._locateButton&&a.inputNode._locateButton._locating?d.resolve():z(["./LocateButton"],f.hitch(this,function(e){this._destroyLocateButton(a.inputNode._locateButton);if(a){var g=t.create("div",{},a.domNode);r.add(a.domNode,this._css.stopsInnerGeocoderClass);var h=new e({map:this.map,
highlightLocation:!1,centerAt:!1,setScale:!1,useTracking:!1},g);h.startup();a.inputNode._locateButton=h;h.domNode._geocoder=a;this._setLocateButtonVisibilityEvents();e=f.hitch(this,function(){h._locating=!0;a.set("value","");a.inputNode.placeholder=l.widgets.directions.retrievingMyLocation.toUpperCase()});h._onBeforeLocate=k(h._locateNode,A,e);h._onLocate=k(h,"locate",f.hitch(this,function(c){h._locating=!1;c.graphic?(b&&this._destroyLocateButton(a.inputNode._locateButton),this.updateStop(new s(c.graphic.geometry),
w.indexOf(this.geocoders,a)).then(f.hitch(this,function(){1<this.stopGraphics.length?this.getDirections().always(function(){d.resolve(c)}):d.resolve(c)}))):(a.set("value",""),a.inputNode.placeholder=l.widgets.directions.myLocationError.toUpperCase(),console.error(c.error),d.reject(c.error))}));c?(e(),h.locate()):d.resolve()}else d.reject()}));return d.promise},_destroyLocateButton:function(a){if(a){var b=a.domNode._geocoder;clearTimeout(b._destroyTimeout);a._locating?b._destroyTimeout=setTimeout(f.hitch(this,
function(){!b._lbShown_lb&&!b._lbShown_f&&this._destroyLocateButton(a)}),100):(a.clear(),a._onBeforeLocate.remove(),a._onLocate.remove(),a._onMouseEnter&&a._onMouseEnter.remove(),a._onMouseOut&&a._onMouseOut.remove(),a.destroy(),b.inputNode&&(b.inputNode._locateButton=null,b._setPlaceholder(b.activeSourceIndex)))}},_validateStops:function(a){if(a)for(var b=0;b<a.length;b++)if(!a[b]||!a[b].feature)return{error:!0,index:b};return{error:!1}},_sortStops:function(){this.stops.length&&(this.stops.sort(f.hitch(this,
function(a,b){for(var c,d,e=0;e<this.get("geocoders").length;e++)this.geocoders[e]._stopReference===a?c=e:this.geocoders[e]._stopReference===b&&(d=e);return c>d?1:d>c?-1:0})),this._setStops())},_getCandidate:function(a){var b=new p,c=typeof a;a?"object"===c&&a.hasOwnProperty("feature")&&a.hasOwnProperty("name")?(a.name=this._isStopAWaypoint(a)?this._waypointName:String(a.name),"point"!==a.feature.geometry.type&&(a.feature.geometry=new N([a.feature.geometry.x,a.feature.geometry.y],this.map.spatialReference)),
b.resolve(a)):"object"===c&&a.hasOwnProperty("address")&&a.hasOwnProperty("location")?(a=this._globalGeocoder._hydrateResult(a),b.resolve(a)):"object"===c&&a.hasOwnProperty("name")&&(null===a.name||""===a.name)?b.resolve(f.clone(this._emptyStop)):a instanceof s&&a.attributes&&(void 0!==a.attributes.Name||a.attributes.isWaypoint)?b.resolve(this._addStopWrapperToGraphic(a,a.attributes.isWaypoint?this._waypointName:String(a.attributes.Name))):("object"===c&&a.hasOwnProperty("name")&&(a=String(a.name)),
this._reverseGeocode(a).then(b.resolve,b.reject)):b.resolve(f.clone(this._emptyStop));return b.promise},_reverseGeocode:function(a){var b=new p,c,d=a.geometry?a.geometry:a;if(this._globalGeocoder){var e=f.hitch(this,function(a){var b=new p,c=500;if(this.map){var e=this.map.toScreen(d);e.x+=ia._calculateClickTolerance([a]);this.map.spatialReference.isWebMercator()?(c=Math.abs(this.map.toMap(e).x-d.x),b.resolve(c)):4326===this.map.spatialReference.wkid?(c=Math.abs(J.geographicToWebMercator(this.map.toMap(e)).x-
J.geographicToWebMercator(d).x),b.resolve(c)):this._geometryService&&(a=new pa,a.distanceUnit=R.UNIT_METER,a.geometry1=d,a.geometry2=this.map.toMap(e),this._geometryService.distance(a,function(a){c=a;b.resolve(c)},function(){b.resolve(c)}))}return b.promise}),g=[],h=this._globalGeocoder.sources,m=function(){h[c].featureLayer&&g.push(e(h[c].featureLayer).then(f.hitch(h[c],function(a){this.searchQueryParams=f.mixin(this.searchQueryParams,{distance:a})})))};if("all"===this._globalGeocoder.activeSourceIndex)for(c=
0;c<h.length;c++)m();else c=this._globalGeocoder.activeSourceIndex,m();H(g).always(f.hitch(this,function(){this._globalGeocoder.search(d).then(f.hitch(this,function(e){var g=!1;if(e){var h=null,f;for(c=0;c<this._globalGeocoder.sources.length;c++)if(e[c]&&e[c].length){f=e[c];break}if(f.length&&(g=!0,h=f[0],this._globalGeocoder.sources[c].featureLayer)){e=Number.POSITIVE_INFINITY;for(c=0;c<f.length;c++){f[c]=this._toPointGeometry(f[c]);var m=ha.geodesicLengths([new Q({paths:[[J.xyToLngLat(d.x,d.y),
J.xyToLngLat(f[c].feature.geometry.x,f[c].feature.geometry.y)]],spatialReference:{wkid:this.map.spatialReference.wkid}})],"esriMeters")[0];e>m&&(e=m,h=f[c])}}(h=this._decorateEmptyAGOLGeocoderResponse(h))&&""!==h.name&&null!==h.name&&void 0!==h.name?(h.name=String(h.name),!isNaN(d.x)&&!isNaN(d.y)&&this.map.spatialReference.wkid===d.spatialReference.wkid?(h.feature.geometry=d,b.resolve(h)):!h.feature.geometry||isNaN(h.feature.geometry.x)||isNaN(h.feature.geometry.y)?(this._resultError(l.widgets.directions.error.locator),
b.reject(l.widgets.directions.error.locator)):b.resolve(h)):g=!1}g||(a instanceof N?a=new s(a):a instanceof Array&&(a=new s(new N(a[0],a[1]))),a instanceof s?this._decorateUngeocodedStop(a).then(b.resolve,b.reject):(this._resultError(l.widgets.directions.error.unknownStop.replace("\x3cname\x3e",a.toString())),b.reject(l.widgets.directions.error.unknownStop.replace("\x3cname\x3e",a.toString()))))}))}))}else this._resultError(l.widgets.directions.error.locatorUndefined),b.reject(l.widgets.directions.error.locatorUndefined);
return b.promise},_updateStop:function(a,b,c){var d=new p;this.stops&&this.stops[b]?a instanceof s&&a.attributes&&a.attributes.isWaypoint&&(!b||b===this.stops.length-1||2>this._getStopCount())?(this._resultError(l.widgets.directions.error.waypointShouldBeInBetweenStops),d.reject(l.widgets.directions.error.waypointShouldBeInBetweenStops)):this._getCandidate(a).then(f.hitch(this,function(a){var g=a.feature,g=g?g.geometry:null,h=this.stops[b].feature,h=h?h.geometry:null,g=g&&h&&(g.x!==h.x||g.y!==h.y)||
!g&&h;this.stops[b]=a;h=this.get("geocoders")[b];h._stopReference=a;h._tr.style.display=this._isStopAWaypoint(a)?"none":"";h.value=a.name;h.inputNode.value=a.name;g&&this.autoSolve||c?this._getDirections().then(d.resolve,d.reject):(this._setStops(),d.resolve(a))}),f.hitch(this,function(a){d.reject(a)})):(this._resultError(l.widgets.directions.error.couldNotUpdateStop),d.reject(l.widgets.directions.error.couldNotUpdateStop));this._optionsMenu();return d.promise},_renderDirections:function(){var a=
this.get("directions"),b;if(this._resultsNode){b=""+('\x3cdiv class\x3d"'+this._css.resultsRouteNameClass+'"\x3e');b+=a.routeName;b=b+"\x3c/div\x3e"+('\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e');if(a.totalLength||a.totalTime){var c=this._formatDistance(a.totalLength,!0),d=this._formatTime(a.totalTime);b+='\x3cdiv class\x3d"'+this._css.resultsSummaryClass+'"\x3e';c&&(b+=c);c&&d&&(b+=" \x26middot; ");d&&(b+=d);b+="\x3c/div\x3e"}b+='\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';
b+='\x3cdiv class\x3d"'+this._css.resultsRouteButtonContainerClass+'"\x3e';b+='\x3cdiv tabindex\x3d"0" role\x3d"button" class\x3d"'+this._css.linkButtonClass+" "+this._css.resultsViewFullRouteClass+'" data-full-route\x3d"true"\x3e'+l.widgets.directions.viewFullRoute+"\x3c/div\x3e";this.get("showPrintPage")&&(b+='\x3cdiv tabindex\x3d"0" role\x3d"button" title\x3d"'+l.widgets.directions.print+'" class\x3d"'+this._css.resultsPrintClass+'" data-print-directions\x3d"true"\x3e\x3c/div\x3e');b+='\x3cdiv class\x3d"'+
this._css.clearClass+'"\x3e\x3c/div\x3e';b+="\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.routesClass+'"\x3e';b+='\x3ctable summary\x3d"'+a.routeName+'"\x3e';b+='\x3ctbody role\x3d"menu"\x3e';for(c=0;c<a.features.length;c++)b+=this._renderDirectionsItemTR(a.features[c],c);b+="\x3c/tbody\x3e";b+="\x3c/table\x3e";b+="\x3c/div\x3e";this._resultsNode&&(this._resultsNode.innerHTML=b);this._disconnectResults();(a=C("[data-segment]",this._resultsNode))&&a.length&&w.forEach(a,f.hitch(this,function(a){this._resultEvents.push(k(a,
G.enter,f.hitch(this,function(){if(!this._focusedDirectionsItem){var b=parseInt(y.get(a,"data-segment"),10);this.highlightSegment(b)}})));this._resultEvents.push(k(a,"focusout",f.hitch(this,function(){this._focusedDirectionsItem=null;this.unhighlightSegment(!0)})));this._resultEvents.push(k(a,G.leave,this.unhighlightSegment));this._resultEvents.push(k(a,"click, keydown",f.hitch(this,function(b){if(b&&("click"===b.type||"keydown"===b.type&&b.keyCode===F.ENTER))this._focusedDirectionsItem!==a?this.selectSegment(parseInt(y.get(a,
"data-segment"),10)):(a.blur(),this.map.infoWindow.hide(),this._focusedDirectionsItem=null,this.unhighlightSegment(!0))})))}))}},_renderDirectionsItemTR:function(a){var b=this.directions,c=b?w.indexOf(b.features,a):-1,d="",e=this._css.routeClass;if(-1<c){a.attributes&&(a.attributes.step=c+1);a.attributes.maneuverType&&(e+=" "+a.attributes.maneuverType);0===c&&a._associatedStop&&1===a._associatedStop.attributes.Sequence?e+=" "+this._css.routeOriginClass:c===b.features.length-1&&(e+=" "+this._css.routeDestinationClass);
c===b.features.length-1&&(e+=" "+this._css.routeLastClass);d+='\x3ctr tabindex\x3d"0" role\x3d"menuitem" class\x3d"'+e+" "+this._css.routeZoomClass+'" data-segment\x3d"'+c+'"\x3e';d+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';d+='\x3cdiv class\x3d"'+this._css.routeIconClass+'"\x3e';d+=this._getLetter(a._associatedStop);d+="\x3c/div\x3e\x3c/td\x3e";d+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';d+='\x3cdiv class\x3d"'+this._css.routeInfoClass+'"\x3e';d+='\x3cdiv class\x3d"'+
this._css.routeTextClass+'"\x3e';b=b.strings[c]||[];if("esriDMTDepart"===a.attributes.maneuverType||"esriDMTStop"===a.attributes.maneuverType)for(c=0;c<this.stops.length;c++)this.stops[c]&&this.stops[c].name&&b.push({string:this.stops[c].name});if(b){e=a.attributes.text;for(c=0;c<b.length;c++)e=this._boldText(e,b[c].string);a.attributes.formattedText=e}else a.attributes.formattedText=a.attributes.text;d+="\x3cstrong\x3e"+L.format(a.attributes.step)+".\x3c/strong\x3e "+a.attributes.formattedText;d+=
"\x3c/div\x3e";b=this._formatDistance(a.attributes.length,!1);a=this._formatTime(a.attributes.time);b&&(d+='\x3cdiv class\x3d"'+this._css.routeLengthClass+'"\x3e',d+=b,a&&(d+=" \x26middot; "+a),d+="\x3c/div\x3e");d+="\x3c/div\x3e";d+="\x3c/td\x3e";d+="\x3c/tr\x3e"}return d},_addStopWrapperToGraphic:function(a,b){return{extent:new ja({xmin:a.geometry.x-0.25,ymin:a.geometry.y-0.25,xmax:a.geometry.x+0.25,ymax:a.geometry.y+0.25,spatialReference:a.geometry.spatialReference}),feature:a,name:b}},_showRoute:function(a){this._clearDisplayAfterSolve();
var b=a.routeResults[0].directions,c=new p;if(b){this.set("solveResult",a);this.set("directions",b);var d=a.routeResults[0].stops,e,g;if(d&&d.length){var h=[],f=d.length;this._startReturn&&f--;for(e=0;e<f;e++){var n=d[e];n.attributes.isWaypoint=n.attributes.Name===this._waypointName;n=this._addStopWrapperToGraphic(n,n.attributes.Name);h.push(n)}this.stops=h;for(e=0;e<this.stops.length;e++)this._updateStop(this.stops[e],e);this._setStops()}this.set("mergedRouteGraphic",new s(b.mergedGeometry,this.get("routeSymbol")));
d=[];h=[];for(e=f=0;e<b.featuresWithWaypoints.length;e++){n=b.featuresWithWaypoints[e];if("esriDMTDepart"===n.attributes.maneuverType)for(g=0;g<this.stops.length;g++)if(this.stops[g].feature===n._associatedStop){f=g+1;break}n.setSymbol(this.get("routeSymbol"));this._routeLayer.add(n);d.push(n);(g=n.getDojoShape())&&g.moveToBack();g=new s(n.geometry,this._symbolEventPaddingDirections,n.attributes);g._nextStopIndex=f-0.5;g._isSnapFeature=!0;n._associatedSnapFeature=g;this._waypointsEventLayer.add(g);
if("esriDMTDepart"!==n.attributes.maneuverType&&(g=n.geometry.getPoint(0,0)))g=new s(g,this.maneuverSymbol),g._directionsFeature=n._associatedFeatureNoWaypoints,h.push(g),this._waypointsEventLayer.add(h[h.length-1])}this.set("displayedRouteGraphics",d);this.set("displayedManeuverPointGraphics",h);this._renderDirections();for(e=0;e<this.stops.length;e++)if(this._isStopAWaypoint(this.stops[e])&&this._modifiedWaypointIndex===e){for(g=0;g<b.featuresWithWaypoints.length;g++)if(d=b.featuresWithWaypoints[g],
d._associatedStop===this.stops[e].feature){if("esriDMTStop"===d.attributes.maneuverType||"esriDMTDepart"===d.attributes.maneuverType)this.stops[e].feature.geometry.x=d.geometry.paths[0][0][0],this.stops[e].feature.geometry.y=d.geometry.paths[0][0][1];break}this._modifiedWaypointIndex=null;break}this.onDirectionsFinish(a)}else a=a.routeResults[0].route,a.setSymbol(this.routeSymbol),this._routeLayer.add(a),this._incrementalRouteSegment=a;c.resolve();this._moveLayersToFront();this.createRouteSymbols();
return c.promise},_setGeocodersStopReference:function(){if(this.geocoders)for(var a=0;a<this.geocoders.length;a++)this.geocoders[a]&&this.stops[a]&&(this.geocoders[a]._stopReference=this.stops[a])},_setStops:function(){this._setGeocodersStopReference();this.createRouteSymbols();this._set("stops",this.stops);this.onStopsUpdate(this.stops)},_getCandidates:function(a){var b=[];if(a&&a.length){for(var c=0;c<a.length;c++)b.push(this._getCandidate(a[c]));return H(b)}a=new p;a.resolve([]);return a.promise},
_clearResultsHTML:function(){this._resultsNode&&(this._resultsNode.innerHTML="")},_showSegmentPopup:function(a){if(a&&this.get("showSegmentPopup")&&this.get("map").infoWindow){var b=a.geometry.getPoint(0,0);a=new s(b,null,a.attributes,this.get("segmentInfoTemplate"));var c=this.get("map").infoWindow;c.setFeatures([a]);c.show(b)}},_removeStopButton:function(a){this.stops.length>this.get("minStops")?this.removeStop(a):(this._setStops(),this._clearDisplayBeforeSolve(),this._clearDisplayAfterSolve())},
_addStopButton:function(){this.addStop().then(f.hitch(this,function(){this.get("focusOnNewStop")&&this.geocoders[this.stops.length-1].focus()}))},_sortGeocoders:function(){var a=this._dnd.getAllNodes();this.geocoders.sort(f.hitch(this,function(b,d){return!b.domNode||!b.domNode.parentNode||!b.domNode.parentNode.parentNode||!d.domNode||!d.domNode.parentNode||!d.domNode.parentNode.parentNode?0:w.indexOf(a,b.domNode.parentNode.parentNode)>w.indexOf(a,d.domNode.parentNode.parentNode)?1:-1}));this._sortStops();
for(var b=0;b<this.geocoders.length;b++)this.geocoders[b].inputNode.title=l.widgets.directions.stopNoTitle+(b+1);this._setLocateButtonVisibilityEvents()},_disconnectResults:function(){if(this._resultEvents&&this._resultEvents.length)for(var a=0;a<this._resultEvents.length;a++)this._resultEvents[a]&&this._resultEvents[a].remove();this._resultEvents=[]},_formatArbitraryCostsForRouteTooltip:function(a){var b="",c=this.serviceDescription.networkDataset.networkAttributes,d;for(d in a)if(0===d.indexOf("Total_")&&
a.hasOwnProperty(d))for(var e=0;e<c.length;e++)c[e].name===d.substr(6)&&"esriNAUTCost"===c[e].usageType&&(b="esriNAUMinutes"===c[e].units?b+this._formatTime(a[d]):b+(L.format(a[d],{places:3,locale:"root"})+" "+c[e].units.substr(7).toLowerCase()),b+=b?" \x26middot; ":"");b&&(b=l.widgets.directions.toNearbyStops+": \x3cb\x3e"+b.substr(0,b.length-10)+"\x3c/b\x3e");return b},_formatTime:function(a){var b,c="";b=Math.round(a);a=Math.floor(b/60);b=Math.floor(b%60);a&&(c+=a+" ",c=1<a?c+l.widgets.directions.time.hours:
c+l.widgets.directions.time.hour);a&&b&&(c+=" ");b&&(c+=b+" ",c=1<b?c+l.widgets.directions.time.minutes:c+l.widgets.directions.time.minute);return c},_formatDistance:function(a,b,c){var d=this._getUnits(this.get("directionsLengthUnits")),e=c?this._getUnits(f.hitch(this,function(){for(var a="",b=this.serviceDescription.networkDataset.networkAttributes,d=0;d<b.length;d++)if(b[d].name===c&&"esriNAUTCost"===b[d].usageType){a=b[d].units;break}return a})()):d,g=l.widgets.directions.units[d];switch(e+"\x3e"+
d){case "MILES\x3eKILOMETERS":a*=1.609344;break;case "KILOMETERS\x3eMILES":a/=1.609344;break;case "METERS\x3eKILOMETERS":a/=1E3;break;case "METERS\x3eMILES":a/=1609.344}d=g?b?g.name:g.abbr:d.replace("esri","").toLowerCase();a=Math.round(100*a)/100;return 0===a?"":L.format(a,{locale:"root"})+" "+d},_editToolbar:function(){this.set("editToolbar",new X(this.get("map")))},_destroyGlobalGeocoder:function(){this._globalGeocoder&&(this._globalGeocoder.destroy(),this._globalGeocoder=null)},_createGlobalGeocoder:function(){var a=
new p;this._globalGeocoder=new V(this.get("searchOptions"));k.once(this._globalGeocoder,"load",f.hitch(this,function(){for(var b=0;b<this._globalGeocoder.sources.length;b++){var c=this._globalGeocoder.sources[b].locator;if(c&&c.url&&(-1<c.url.toUpperCase().indexOf(this._globalGeocoder.defaultSource.locator.url.toUpperCase())||-1<c.url.toUpperCase().indexOf("//GEOCODEDEV.ARCGIS.COM/ARCGIS/REST/SERVICES/WORLD/GEOCODESERVER"))&&!this._globalGeocoder.sources[b].searchTemplate){this._globalGeocoder.sources[b].searchTemplate=
"${Address}, ${City}, ${Region}";break}}a.resolve()},function(b){a.reject(b)}));this._globalGeocoder.startup();return a.promise},_init:function(){var a=new p;this.set("loaded",!1);this.clearErrors();if(this.get("map").loaded)this._configure().always(a.resolve);else k.once(this.get("map"),"load",f.hitch(this,function(){this._configure().always(a.resolve)}));return a.promise},_setDefaultStops:function(){var a=new p;this.defaults.stops&&this.defaults.stops.length?this._updateStops(this.defaults.stops).then(f.hitch(this,
function(){this._removeEmptyStops();a.resolve()}),a.reject):a.resolve();return a.promise},_configure:function(){var a=new p;this._handle&&this._handle._remove();this._createDnD();this._setSearchOptions();this._createGlobalGeocoder().then(f.hitch(this,function(){this._editToolbar();this._usingAGOL()||(this.printTaskUrl=this.geometryTaskUrl=null);this._createGeometryTask();this._createPrintTask();this._showActivateButton();this._createTravelModesDDL();this._createSearchSourceDDL();var b=[this._createRouteTask(),
this._setDefaultStops()];H(b).then(f.hitch(this,function(){this._setDefaultUnits();this._setTrafficOptions();this._setMenuNodeValues();this._setupEvents();this._setDirectionsLanguageByLocale(!this.directionsLanguage?S.locale.toLowerCase():this.directionsLanguage);this._setupTravelModes().then(f.hitch(this,function(){this.set("loaded",!0);this.onLoad();a.resolve(!0)}),function(b){a.reject(b)})}),function(b){a.reject(b)})}),function(b){a.reject(b)});return a.promise},_setDirectionsLanguageByLocale:function(a){var b=
this.serviceDescription.directionsSupportedLanguages,c=function(a){if(b)for(var c=0;c<b.length;c++)if(b[c].toLowerCase().substr(0,2)===a)return b[c];return null},d=c(a);d||(a=a.substr(0,2),d=c(a));this.directionsLanguage=d;return this.routeParams.directionsLanguage=d},_getStopSymbol:function(a,b,c,d){return void 0===d||0===d||6===d?0===a?this.get(c?"fromSymbolDrag":"fromSymbol"):a===b-1?this.get(c?"toSymbolDrag":"toSymbol"):this.get(c?"stopSymbolDrag":"stopSymbol"):this.get(c?"unreachedSymbolDrag":
"unreachedSymbol")},_addTrafficLayer:function(){var a=this.get("trafficLayer");a&&!this._trafficLayerAdded&&(this.get("map").addLayer(a),a.show(),this._trafficLayerAdded=!0)},_toggleUnits:function(a){a.target===this._useMilesNode?this.setDirectionsLengthUnits(u.MILES):a.target===this._useKilometersNode&&this.setDirectionsLengthUnits(u.KILOMETERS)},_toggleCheckbox:function(a){var b=y.get(a.target,"checked");a.target===this._findOptimalOrderNode?this.set("optimalRoute",b):a.target===this._useTrafficNode?
this.set("traffic",b):a.target===this._returnToStartNode&&this.set("returnToStart",b)},_configureRouteOptions:function(){var a=this.get("routeParams"),b;this.get("directionsLengthUnits")?a.directionsLengthUnits=this.get("directionsLengthUnits"):this.set("directionsLengthUnits",a.directionsLengthUnits);a.findBestSequence=this.get("optimalRoute");if(a.findBestSequence)for(b=0;b<this.stops.length;)this._isStopAWaypoint(this.stops[b])?this._removeStop(b,!0,!0):b++;if(!this.returnToStart&&this.stops.length&&
this._isStopAWaypoint(this.stops[this.stops.length-1]))for(b=this.stops.length-1;0<b;)this._isStopAWaypoint(this.stops[b])&&this._removeStop(b,!0,!0),b--;this._updateTrafficCheckbox();this.get("traffic")&&!this._useTrafficNode.disabled?(a.startTime=new Date,a.startTimeIsUTC=!0,this._addTrafficLayer()):(a.startTime=null,a.startTimeIsUTC=null,this._removeTrafficLayer());a.returnStops=!0;var c=[];for(b=0;b<this.stopGraphics.length;b++)this.stopGraphics[b]&&c.push(new s(this.stopGraphics[b].toJson()));
this.get("returnToStart")&&this.stopGraphics.length&&this.stopGraphics[0]?(this._startReturn=b=new s(this.stopGraphics[0].toJson()),c.push(b)):this._startReturn=null;a.stops.features=c;this.set("routeParams",a)},_configureRoute:function(){var a=new p;this.createRouteSymbols();this._configureRouteOptions();this.routeParams.returnRoutes&&this._incrementalSolveStopRange?this.routeParams.stops.features=this.routeParams.stops.features.slice(this._incrementalSolveStopRange.start,this._incrementalSolveStopRange.end+
1):this._incrementalSolveStopRange=null;var b={},c,d=this.routeParams.stops.features,e,g;for(c=0;c<d.length;c++)g=d[c].attributes.address,e=(c===this._handle._index&&!this._handle.attributes.isWaypoint&&this._incrementalSolveStopRange?this._waypointName:g)+"_"+this._stopSequence++,d[c].attributes.Name=e,b[e]=g,delete d[c].attributes.address,delete d[c].attributes.isWaypoint,delete d[c].attributes.Status;this._solveInProgress=!0;this.routeTask.solve(this.routeParams,f.hitch(this,function(d){this._solveInProgress=
!1;var e=d.routeResults[0],g=e.directions,e=e.stops;if(g){var k=function(a){for(var c in b)if(a&&0===g.routeName.indexOf(c)||!a&&0<g.routeName.indexOf(c))return b[c];return""},q=k(!0),k=k(!1);g.routeName=(q!==this._waypointName?q:l.widgets.directions.waypoint)+" \u2014 "+(k!==this._waypointName?k:l.widgets.directions.waypoint);for(c=0;c<g.features.length;c++)if(q=g.features[c].attributes,"esriDMTDepart"===q.maneuverType||"esriDMTStop"===q.maneuverType)for(var p in b)if(b.hasOwnProperty(p)&&-1<q.text.indexOf(p)){q.text=
q.text.replace(p,b[p]);for(var k=null,r=0;r<e.length;r++)if(e[r].attributes.Name===p){k=e[this.returnToStart&&r===e.length-1?0:r];break}g.features[c]._associatedStop=k}for(c=0;c<e.length;c++)e[c].attributes.Name=b[e[c].attributes.Name];this._directionsPostprocessing(g)}this._showRoute(d).always(f.hitch(this,function(){this._incrementalSolveStopRange=null;a.resolve(d)}))}),f.hitch(this,function(b){this._solveInProgress=!1;for(var c=0;c<this.stops.length;c++)this.stops[c].feature.attributes=f.mixin(this.stops[c].feature.attributes,
{Status:5});this.set("directions",null);this._clearDisplayAfterSolve();this.createRouteSymbols();this._routeTaskError(b);a.reject(b)}));return a.promise},_directionsPostprocessing:function(a){var b,c,d=function(b,c){var d=a.features[b]._associatedFeaturesWithWaypoints||[];d.push(a.featuresWithWaypoints[c]);a.features[b]._associatedFeaturesWithWaypoints=d;a.featuresWithWaypoints[c]._associatedFeatureNoWaypoints=a.features[b]};c=f.hitch(this,function(a){return"\x3cdiv class\x3d'"+this.theme+"'\x3e\x3ctable class\x3d'esriRoutesTooltip'\x3e"+
this._renderDirectionsItemTR(a._associatedFeatureNoWaypoints)+"\x3c/table\x3e\x3c/div\x3e"});a.featuresWithWaypoints=[];for(b=0;b<a.features.length;b++){var e=new s(a.features[b].toJson());e.setInfoTemplate(new M({title:this._i18n.widgets.directions.maneuver,content:c}));a.featuresWithWaypoints.push(e);a.featuresWithWaypoints[b]._associatedStop=a.features[b]._associatedStop}for(c=b=0;b<a.features.length;)a.features[b]._associatedStop&&a.features[b]._associatedStop.attributes.Name===this._waypointName?
(a.features.splice(b,b?2:1),a.strings.splice(b,b?2:1),b&&a.features[b]&&"esriDMTStraight"===a.features[b].attributes.maneuverType?(e=a.features.splice(b,1)[0],a.strings.splice(b,1),a.features[b-1].attributes.length+=e.attributes.length,a.features[b-1].attributes.time+=e.attributes.time,a.features[b-1].geometry.paths[0]=a.features[b-1].geometry.paths[0].concat(e.geometry.paths[0]),d(b-1,c++),d(b-1,c++),d(b-1,c++)):(b&&d(b-1,c++),b<a.features.length&&d(b,c++))):(d(b,c++),b++)},_boldText:function(a,
b){return a.replace(RegExp("(^|\\s|\\W)("+b+")(\\W|\\s|$)","ig"),"$1\x3cstrong\x3e$2\x3c/strong\x3e$3")},_clearStopGraphics:function(){if(this.stopGraphics&&this.stopGraphics.length)for(var a=0;a<this.stopGraphics.length;a++)this._stopLayer.remove(this.stopGraphics[a]),this._stopLayer.remove(this.textGraphics[a]);this.set("stopGraphics",[]);this.set("textGraphics",[])},_clearRouteGraphics:function(){for(var a=this.displayedRouteGraphics,b=this.displayedManeuverPointGraphics,c=this._routeLayer,d=this._waypointsEventLayer,
e=0,g=0,f=this._incrementalSolveStopRange?this._incrementalSolveStopRange:{start:0,end:this.stops?this.stops.length:-1};a&&g<a.length;){if(a[g]._associatedStop)for(var m=0;m<this.stops.length;m++)if(this.stops[m].feature===a[g]._associatedStop){e=m;break}e>=f.start&&e<f.end?(c.remove(a[g]),a.splice(g,1)):g++}c.remove(this._incrementalRouteSegment);this.set("displayedRouteGraphics",a?a:[]);b&&b.length&&w.forEach(b,function(a){d.remove(a)});this.set("displayedManeuverPointGraphics",[]);this._waypointsEventLayer.clear();
this.unhighlightSegment(!0)},_clearInfoWindow:function(){var a=this.get("map").infoWindow;a&&(a.hide(),a.clearFeatures())},_clearDisplayBeforeSolve:function(){this._clearInfoWindow();this._clearResultsHTML()},_clearDisplayAfterSolve:function(){this._clearStopGraphics();this._clearRouteGraphics();this.clearErrors()},_getLetter:function(a){var b=this.alphabet,c="",d=function(a){var c="";"0123456789"===b||"1234567890"===b?c=String(a+1):(a=a||0,a>=b.length&&(c=d(Math.floor(a/b.length)-1),a%=b.length),
c+=b[a]);return c},e=a instanceof s?f.hitch(this,function(){for(var b=this.get("returnToStart")?this.stops.length:-1,c=0;c<this.stops.length;c++)if(this.stops[c].feature===a){b=c;break}return b})():a;if(-1<e&&b&&b.length){b instanceof Array&&(b=b.toString().replace(/,/g,""));for(var c=-1,g=0;g<=e;g++)c+=!this._isStopAWaypoint(this.stops[g])?1:0;c=d(c)}return c},_solveAndZoom:function(a){if(this.autoSolve)return this._getDirections().then(f.hitch(this,function(){a||this.zoomToFullRoute()}));var b=
new p;b.resolve();return b.promise},_setupEvents:function(){var a=k(this._dndNode,"[data-reverse-stops]:click, [data-reverse-stops]:keydown",f.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===F.ENTER)&&this.modifyStopSequence()}));this._onEvents.push(a);a=k(this._resultsNode,"[data-print-directions]:click, [data-print-directions]:keydown",f.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===F.ENTER)&&this._printDirections()}));this._onEvents.push(a);
a=k(this._resultsNode,"[data-full-route]:click, [data-full-route]:keydown",f.hitch(this,function(a){a&&("click"===a.type||"keydown"===a.type&&a.keyCode===F.ENTER)&&this.zoomToFullRoute()}));this._onEvents.push(a);a=k(this._dndNode,"[data-remove]:click, [data-remove]:keydown",f.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===F.ENTER)){var b=C("[data-remove]",this._dndNode);a=w.indexOf(b,a.target);this._removeStopButton(a)}}));this._onEvents.push(a);this._onEvents.push(k(this._dndNode,
"[data-center-at]:click, [data-center-at]:keydown",f.hitch(this,function(a){if(a&&("click"===a.type||"keydown"===a.type&&a.keyCode===F.ENTER)){var b=C("[data-center-at]",this._dndNode);a=w.indexOf(b,a.target);this.stops[a]&&(this.stops[a].feature&&this.stops[a].feature.geometry)&&this.map.centerAndZoom(this.stops[a].feature.geometry)}})));this._onEvents.push(k(this.map,"zoom-end",f.hitch(this,function(){var a=this._segmentGraphics;a&&(a[0]&&void 0!==a[0].attributes._index)&&this.highlightSegment(a[0].attributes._index,
!0)})));a=k(this._dnd,"Drop",f.hitch(this,function(){this._dnd.sync();this.set("optimalRoute",!1);var a,b,c=!1,f=[],m=this._dnd.getAllNodes();for(a=0;a<this.geocoders.length;a++)if(b=w.indexOf(m,this.geocoders[a]._tr),-1<b&&a!==b&&a!==b-1){for(;0<b&&this._isStopAWaypoint(this.stops[b]);)b--;c=!0;break}c&&(f=this._markWPsForRemovalAfterUserChangedStopSequence(a,b));this._sortGeocoders();this.setListIcons();this._removeSomeWaypoints(f);this.stops[b].name&&this.getDirections()}));this._onEvents.push(a);
a=k(this._dnd,"DndStart",f.hitch(this,function(){var a=C("body")[0];r.add(a,this._css.dndDragBodyClass);this._removeLocateButtonVisibilityEvents()}));this._onEvents.push(a);a=k(this._dnd,"DndDrop, DndCancel",f.hitch(this,function(){var a=C("body")[0];r.remove(a,this._css.dndDragBodyClass);this._setLocateButtonVisibilityEvents()}));this._onEvents.push(a);var b=this._handle,a=f.hitch(this,function(a){var c=f.hitch(this,function(c,e,f,g,k){var p=b._isShown();b.setGeometry(c);b._tooltip.style.left=a.screenPoint.x+
"px";b._tooltip.style.top=a.screenPoint.y+"px";if(p&&(b._index!==f||b.attributes.isWaypoint!==g))b._remove(),p=!1;b.setSymbol(e);b._index=f;b._isStopIcon=b._index===Math.floor(b._index);b.attributes.isWaypoint=g;b._isStopIcon&&(b.attributes.address=this.stopGraphics[f].attributes.address,b.setInfoTemplate(this.stopGraphics[f].infoTemplate));if(this.canModifyWaypoints||b._isStopIcon)p||(this._stopLayer.add(b),(c=b.getDojoShape())&&c[g?"moveToBack":"moveToFront"].call(c)),this.editToolbar.activate(X.MOVE,
b);g=g?b._isStopIcon?l.widgets.directions.dragWaypoint:this.canModifyWaypoints?l.widgets.directions.dragRoute:"":l.widgets.directions.dragStop;b._showTooltip(k||g)});this.unhighlightSegment();if(this.mapClickActive&&this.dragging&&!this._solveInProgress&&!this._moveInProgress&&!b._solveTimeout)if(clearTimeout(b._removeTimeout),(a.graphic._isStopIcon||a.graphic._isStopLabel)&&!a.graphic.attributes.isWaypoint&&this.canModifyStops||a.graphic._isStopIcon&&a.graphic.attributes.isWaypoint&&this.canModifyWaypoints){var g=
a.graphic._isStopLabel?this.stopGraphics[a.graphic._index]:a.graphic;c(g.geometry,g.attributes.isWaypoint?this.waypointSymbol:this._getStopSymbol(g._index,this.stopGraphics.length,!0,g.attributes.Status),g._index,!0===g.attributes.isWaypoint);this._stopLayer.remove(this.stopGraphics[g._index]);this._stopLayer.remove(this.textGraphics[g._index])}else if(a.graphic._isSnapFeature||a.graphic._isHandle&&!a.graphic._isStopIcon)this._snappingManager||(this._snappingManager=this.map.snappingManager),this._snappingManager.getSnappingPoint(a.screenPoint).then(f.hitch(this,
function(f){if(!this._moveInProgress&&f){for(var g=this.displayedManeuverPointGraphics,n=null,k=0;k<g.length;k++)if(g[k].geometry.x===f.x&&g[k].geometry.y===f.y){n=g[k]._directionsFeature;g=w.indexOf(this.directions.features,n);-1<g&&this.highlightSegment(g);break}c(f,a.graphic._isHandle?b.symbol:this.waypointSymbol,a.graphic._isHandle?b._index:a.graphic._nextStopIndex,a.graphic._isHandle?b.attributes.isWaypoint:!0,n)}}))}),c=f.hitch(this,function(){clearTimeout(b._removeTimeout);b._removeTimeout=
setTimeout(b._remove,100);this.unhighlightSegment()});this._onEvents.push(this._waypointsEventLayer.on("mouse-move",a));this._onEvents.push(this._waypointsEventLayer.on("mouse-out",c));this._onEvents.push(this._stopLayer.on("mouse-move",a));this._onEvents.push(this._stopLayer.on("mouse-out",c));this._editToolbarEvents();a=this.watch("theme",this._updateThemeWatch);this._watchEvents.push(a);this._watchEvents.push(this.watch("canModifyStops",this._updateCanModifyStops));this._watchEvents.push(this.watch("canModifyWaypoints",
this._updateCanAddWaypoints));a=this.watch("showReturnToStartOption",this._optionsMenu);this._watchEvents.push(a);a=this.watch("showOptimalRouteOption",this._optionsMenu);this._watchEvents.push(a);a=this.watch("returnToStart",this._setMenuNodeValues);this._watchEvents.push(a);a=this.watch("optimalRoute",this._setMenuNodeValues);this._watchEvents.push(a);a=this.watch("routeTaskUrl",f.hitch(this,function(){this._createRouteTask();this._setTrafficOptions()}));this._watchEvents.push(a);this._watchEvents.push(this.watch("printTaskUrl",
f.hitch(this,function(){this._createPrintTask()})));this._watchEvents.push(this.watch("geometryTaskUrl",f.hitch(this,function(){this._createGeometryTask()})));a=this.watch("routeParams",f.hitch(this,function(){this._createRouteParams();this._setDefaultUnits()}));this._watchEvents.push(a);a=this.watch("searchOptions",f.hitch(this,function(){this._setSearchOptions();this._createGlobalGeocoder();var a=this.get("searchOptions").sources;if(a)for(var b=0;b<this.geocoders.length;b++)this.geocoders[b].set("sources",
a)}));this._watchEvents.push(a);a=this.watch("showReverseStopsButton",this.setListIcons);this._watchEvents.push(a);a=this.watch("showPrintPage",this._renderDirections);this._watchEvents.push(a);a=this.watch("trafficLayer",this._trafficLayerUpdate);this._watchEvents.push(a);a=this.watch("editToolbar",this._editToolbarEvents);this._watchEvents.push(a);a=this.watch("showTravelModesOption",this._showTravelModesOption);this._watchEvents.push(a);a=this.watch("showMilesKilometersOption",this._showMilesKilometersOption);
this._watchEvents.push(a);a=this.watch("showClearButton",this._showClearButton);this._watchEvents.push(a);a=this.watch("directionsLengthUnits",this.setDirectionsLengthUnits);this._watchEvents.push(a);this._watchEvents.push(this.watch("directionsLanguage",this.setDirectionsLanguage));this._watchEvents.push(this.watch("mapClickActive",this._activate));this._watchEvents.push(this.watch("showActivateButton",this._showActivateButton))},_editToolbarEvents:function(){var a=f.hitch(this,function(a){var b=
"";if((a=a.routeResults?a.routeResults[0]:null)&&a.route){a=a.route.attributes;var e=this.routeParams.travelMode;if(e){var b=b+("\x3cb\x3e"+e.name+"\x3c/b\x3e "+l.widgets.directions.toNearbyStops+": "),f=void 0!==a["Total_"+e.timeAttributeName]?this._formatTime(a["Total_"+e.timeAttributeName]):"";a=(void 0!==a["Total_"+e.distanceAttributeName]?this._formatDistance(a["Total_"+e.distanceAttributeName],!1,e.distanceAttributeName):"")+(f?" \x26middot; "+f:"");b+=a}else b=this._formatArbitraryCostsForRouteTooltip(a)}this._handle._showTooltip(b)}),
b=f.hitch(this,function(c,d){var e=new p,g=this._handle,h=this.map.toScreen(g._origPoint).offset(c.transform.dx,c.transform.dy);c.origMapPoint||(c.origMapPoint=this.map.toMap(h));x.set(g._tooltip,"left",h.x+"px");x.set(g._tooltip,"top",h.y+"px");clearTimeout(g._solveTimeout);if(this._solveInProgress||!this._requestQueueTail.isFulfilled())g._solveTimeout=setTimeout(function(){b(c,d).always(e.resolve)},100);else if(g._isStopIcon){var h=c.graphic._index,m=this.stops[h],m={name:m.name,extent:m.extent,
feature:new s(m.feature.toJson())};m.feature.setGeometry(c.origMapPoint);this._modifiedWaypointIndex=this._isStopAWaypoint(this.stops[h])?h:null;this._incrementalSolveStopRange={start:Math.max(0,h-1),end:Math.min(this.stops.length-1,h+1)};this.updateStop(m,h,d).always(f.hitch(this,function(b){g._solveTimeout=null;b.routeResults&&a(b);e.resolve()}))}else e.resolve();return e.promise});this._onEvents.push(k(this.editToolbar,"graphic-click",f.hitch(this,function(a){if(a.graphic.attributes.isWaypoint)a.graphic._isStopIcon&&
(!this._moveInProgress&&!this._solveInProgress)&&(this._handle._remove(),this._moveInProgress=!0,this.removeStop(a.graphic._index,!0).always(f.hitch(this,function(){this._moveInProgress=!1})));else{var b=this.get("map").infoWindow;b&&(b.setFeatures([a.graphic]),b.show(a.graphic.geometry))}})));this._onEvents.push(k(this.editToolbar,"graphic-move-start",f.hitch(this,function(a){this._blurGeocoders();this._moveInProgress=!0;this._removeEmptyStops();this.routeParams.returnDirections=!1;this.routeParams.returnRoutes=
!0;a=a.graphic;a._origPoint=new N(a.geometry.toJson());a._maxDeviation=0;a._solveHasHappened=!1;this.map.disableMapNavigation()})));this._onEvents.push(k(this.editToolbar,"graphic-move-stop",f.hitch(this,function(a){this.map.enableMapNavigation();this.routeParams.returnDirections=!0;this.routeParams.returnRoutes=!1;this._handle._isStopIcon?this._handle._solveHasHappened?this._handle.attributes.isWaypoint?b(a,!0).always(f.hitch(this,function(){this._moveInProgress=!1;this._handle._isStopIcon=!0;this._handle._remove();
this._showLoadingSpinner()})):(clearTimeout(this._handle._solveTimeout),this._handle._solveTimeout=null,this._reverseGeocode(new s(a.graphic.toJson())).then(f.hitch(this,function(b){this._setReverseGeocode(b,b.feature.geometry,a.graphic._index).always(f.hitch(this,function(){this._moveInProgress=!1;this._handle._remove();this._showLoadingSpinner()}))}))):this._moveInProgress=!1:this._moveInProgress=!1})));this._onEvents.push(k(this.editToolbar,"graphic-move",f.hitch(this,function(a){var d=this._handle,
e=a.transform;e.dx&&e.dy&&(a.graphic._maxDeviation=Math.max(d._maxDeviation,Math.sqrt(e.dx*e.dx+e.dy*e.dy)));10<d._maxDeviation&&(d._solveHasHappened=!0,a.graphic===d&&d.attributes.isWaypoint&&!d._isStopIcon?(this.set("optimalRoute",!1),d._index+=0.5,d._isStopIcon=!0,a.graphic._stopIndex=d._index,this._incrementalSolveStopRange={start:Math.max(0,d._index-1),end:Math.min(this.stops.length,d._index+1)},this.addStop({name:this._waypointName,feature:new s(d.geometry,d.symbol,{isWaypoint:!0,CurbApproach:3})},
a.graphic._stopIndex)):((d=a.graphic.getDojoShape())&&d.moveToFront(),b(a)))})))},_isStopAWaypoint:function(a){return a&&a.feature&&a.feature.attributes&&a.feature.attributes.isWaypoint},_getStopCount:function(){var a=0,b;for(b=0;b<this.stops.length;b++)a+=!this._isStopAWaypoint(this.stops[b])&&this.stops[b].name?1:0;return a},_getWaypointCount:function(){var a=0,b;for(b=0;b<this.stops.length;b++)a+=this._isStopAWaypoint(this.stops[b])?1:0;return a},_decorateUngeocodedStop:function(a){var b=new p,
c=function(c,d){b.resolve({name:void 0===c?l.widgets.directions.unlocatedStop:c.toFixed(6)+" "+d.toFixed(6),feature:a})};if(a.geometry)if(a.geometry.spatialReference&&4326!==a.geometry.spatialReference.wkid)if(this.map&&this.map.spatialReference&&this.map.spatialReference.isWebMercator()){var d=J.xyToLngLat(a.geometry.x,a.geometry.y);c(d[0],d[1])}else this._geometryService?(d=new ua,d.outSR=new fa(4326),d.geometries=[a.geometry],this._geometryService.project(d).then(f.hitch(this,function(b){b&&b.length?
c(b[0].x,b[0].y):c(a.geometry.x,a.geometry.y)}),f.hitch(this,function(){c()}))):c(a.geometry.x,a.geometry.y);else c(a.geometry.x,a.geometry.y);else c();return b.promise},_trafficLayerUpdate:function(a,b,c){a=this.get("map");b&&this._trafficLayerAdded&&(a.removeLayer(b),this._trafficLayerAdded=!1);c&&(this.get("traffic")&&!this._trafficLayerAdded)&&(a.addLayer(c),c.show(),this._trafficLayerAdded=!0)},_routeTaskError:function(a){var b=l.widgets.directions.error.routeTask,c=a.details;c&&1===c.length&&
("The distance between any inputs must be less than 50 miles (80 kilometers) when walking."===c[0]?b=l.widgets.directions.error.maxWalkingDistance:"Driving a truck is currently not supported outside of North America and Central America."===c[0]&&(b=l.widgets.directions.error.nonNAmTruckingMode));this._resultError(b);this.onDirectionsFinish(a)},_resultError:function(a){var b="";this.errors.push(a);b+='\x3cdiv class\x3d"'+this._css.routesErrorClass+'"\x3e';if(this.errors.length){for(var b=b+"\x3cul\x3e",
c=0;c<this.errors.length;c++)b+="\x3cli\x3e"+this.errors[c]+"\x3c/li\x3e";b+="\x3c/ul\x3e"}b+="\x3c/div\x3e";this._errorNode&&(this._errorNode.innerHTML=b);this.onError(a)},_getUnits:function(a){switch(a){case "esriNAUKilometers":case u.KILOMETERS:return"KILOMETERS";case "esriNAUMeters":case u.METERS:return"METERS";case "esriNAUNauticalMiles":case u.NAUTICAL_MILES:return"NAUTICAL_MILES";case "esriNAUMiles":case u.MILES:return"MILES";default:return a}},_createRouteTask:function(){var a=new p;this.set("routeTask",
new na(this.get("routeTaskUrl")));this._createRouteParams();this.routeTask.getServiceDescription(this.travelModesServiceUrl,this.doNotFetchTravelModesFromOwningSystem).then(f.hitch(this,function(b){b.networkDataset?(this.set("serviceDescription",b),b.serviceLimits&&b.serviceLimits.Route_MaxStops&&this.set("maxStops",b.serviceLimits.Route_MaxStops),a.resolve()):(this._resultError(l.widgets.directions.error.cantFindRouteServiceDescription),a.reject(l.widgets.directions.error.cantFindRouteServiceDescription))}),
f.hitch(this,function(){this._resultError(l.widgets.directions.error.cantFindRouteServiceDescription);a.reject(l.widgets.directions.error.cantFindRouteServiceDescription);this.mapClickActive=!1;this._activate()}));return a.promise},_createSearchSourceDDL:function(){if(!this._searchSourceSelector&&this._globalGeocoder&&this._globalGeocoder.sources&&1<this._globalGeocoder.sources.length){for(var a=f.hitch(this,function(a){this._searchSourceSelector.domNode.blur();this._globalGeocoder.set("activeSourceIndex",
a);for(var b=0;b<this.geocoders.length;b++)this.geocoders[b].set("activeSourceIndex",a)}),b=[{value:"all",label:l.widgets.Search.main.all,selected:!0}],c=0;c<this._globalGeocoder.sources.length;c++)b.push({value:String(c),label:this._globalGeocoder.sources[c].name});this._searchSourceSelector=new T({className:"esriSearchSourcesDDL",style:"width:100%;",options:b},this._searchSourceSelectorContainer);this._searchSourceSelector.startup();this._searchSourceSelector.on("change",a);a("all");this._searchSourceSelector.domNode.style.width=
""}else 2>this._globalGeocoder.sources.length&&(this._searchSourceContainerNode.style.display="none")},_createTravelModesDDL:function(){this._travelModeSelector||(this._travelModeSelector=new T({className:"esriTravelModesDDL",style:"width:100%;"},this._travelModeSelectorContainer),this._travelModeSelector.startup(),this._travelModeSelector._interractive=!0,this._travelModeSelector.on("change",f.hitch(this,function(a){this._travelModeSelector._interractive&&this._enqueue(function(){this.clearErrors();
return this._setTravelMode(a)})})))},_setupTravelModes:function(){var a=this.get("serviceDescription"),b=a.supportedTravelModes,c=new p;if(b&&b.length&&this._travelModeSelector){for(var d=b[0].name,e=[],g=0;g<b.length;g++){for(var h="AUTOMOBILE"===b[g].type?"Driving":"TRUCK"===b[g].type?"Trucking":"WALK"===b[g].type?"Walking":"Other",m="",k=a.networkDataset.networkAttributes,l=0;l<k.length;l++){var q=k[l];if(q.name===b[g].impedanceAttributeName){if("esriNAUCentimeters"===q.units||"esriNAUDecimalDegrees"===
q.units||"esriNAUDecimeters"===q.units||"esriNAUFeet"===q.units||"esriNAUInches"===q.units||"esriNAUKilometers"===q.units||"esriNAUMeters"===q.units||"esriNAUMiles"===q.units||"esriNAUMillimeters"===q.units||"esriNAUNauticalMiles"===q.units||"esriNAUYards"===q.units)m="Distance";else if("esriNAUDays"===q.units||"esriNAUHours"===q.units||"esriNAUMinutes"===q.units||"esriNAUSeconds"===q.units)m="Time";break}}e.push({id:b[g].name,label:'\x3cdiv class\x3d"esriTravelModesDirectionsIcon esriTravelModesType'+
h+m+'"\x3e\x26nbsp;\x3c/div\x3e\x3cdiv class\x3d"esriTravelModesTypeName"\x3e'+b[g].name+"\x3c/div\x3e"});if(a.defaultTravelMode&&(b[g].id===a.defaultTravelMode||b[g].itemId===a.defaultTravelMode))d=b[g].name}this._showTravelModesOption();this._travelModeSelector.setStore(new $({objectStore:new Z({data:e})}));this._travelModeSelector._interractive=!1;this._travelModeSelector.setValue(d);this._setTravelMode(d).always(f.hitch(this,function(){this._travelModeSelector._interractive=!0;c.resolve()}))}else this.set("showTravelModesOption",
!1),c.resolve();return c.promise},_createPrintTask:function(){this._printService=(this.printTaskUrl=this._usingAGOL()?this.printTaskUrl:this.defaults.printTaskUrl)?new qa(this.printTaskUrl,{async:!1}):null;var a=new sa;a.exportOptions={width:670,height:750,dpi:96};a.format="PNG32";a.layout="MAP_ONLY";a.preserveScale=!1;a.showAttribution=!1;var b=new ra;b.map=this.map;b.outSpatialReference=this.map.spatialReference;b.template=a;this._printParams=b},_createGeometryTask:function(){this._geometryService=
null;this._usingAGOL()?this._geometryService=new R(this.geometryTaskUrl):this.geometryTaskUrl=(this._geometryService=this.defaults.geometryTaskUrl?new R(this.defaults.geometryTaskUrl):ta.defaults.geometryService)?this._geometryService.url:null},_showTravelModesOption:function(){var a=this.get("serviceDescription");x.set(this._travelModeContainerNode,"display",this.showTravelModesOption&&a&&a.supportedTravelModes&&a.supportedTravelModes.length&&!this.doNotFetchTravelModesFromOwningSystem?"block":"none")},
_showMilesKilometersOption:function(){x.set(this._agolDistanceUnitsNode,"display",this.showMilesKilometersOption?"block":"none")},_showClearButton:function(){x.set(this._clearDirectionsButtonNode,"display",this.showClearButton?"inline-block":"none")},_showActivateButton:function(){x.set(this._activateButtonNode,"display",this.showActivateButton?"inline-block":"none");this.showActivateButton||this.deactivate()},_createRouteParams:function(){var a={returnDirections:!0,returnRoutes:!1,outputLines:"esriNAOutputLineTrueShape",
preserveFirstStop:!0,preserveLastStop:!0,directionsOutputType:"complete",stops:new ma,ignoreInvalidLocations:!0,doNotLocateOnRestrictedElements:!0,outSpatialReference:this.get("map").spatialReference};this.get("routeParams")||(this.routeParams={});var b=new oa;this.routeParams=f.mixin(b,{outputGeometryPrecision:0,outputGeometryPrecisionUnits:"esriMeters",restrictUTurns:"esriNFSBAtDeadEndsOnly"},this.get("routeParams"),a)},_markWPsForRemovalAfterUserChangedStopSequence:function(a,b){for(var c=a-1,
d=[];0<=c&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c--;for(c=a+1;c<this.stops.length&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c++;if(b>a)for(c=b+1;c<this.stops.length&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c++;else for(c=b-1;0<=c&&this._isStopAWaypoint(this.stops[c]);)d.push(this.stops[c]),c--;return d},_removeSomeWaypoints:function(a){for(var b=new p,c=[],d=0;d<a.length;d++){var e=w.indexOf(this.stops,a[d]);-1<e&&c.push(this._removeStop(e,
!0,!0))}H(c).always(b.resolve);return b.promise},_modifyStopSequence:function(a,b){var c=this._dnd.getAllNodes(),d=new p;if(c.length)if(this._removeLocateButtonVisibilityEvents(),arguments.length&&void 0!==a)if(0<=a&&0<=b&&a<this.stops.length&&b<this.stops.length&&a!==b){var c=this._markWPsForRemovalAfterUserChangedStopSequence(a,b),e=this.stops.splice(a,1),g=[];this.stops.splice(b,0,e[0]);for(e=0;e<this.stops.length;e++)g.push(this._updateStop(this.stops[e],e));g.push(this._removeSomeWaypoints(c));
H(g).always(f.hitch(this,function(){this._solveAndZoom().always(d.resolve)}))}else d.reject("Invalid From and To values.");else c.reverse(),this._dnd.clearItems(),this._dnd.insertNodes(!1,c),this._dnd.sync(),this._sortGeocoders(),this.setListIcons(),this._solveAndZoom().always(d.resolve);else d.resolve();return d.promise},_setMenuNodeValues:function(){var a=this.get("optimalRoute");this._findOptimalOrderNode&&y.set(this._findOptimalOrderNode,"checked",a);a=this.get("returnToStart");this._returnToStartNode&&
y.set(this._returnToStartNode,"checked",a);a=this.get("traffic");this._useTrafficNode&&y.set(this._useTrafficNode,"checked",a);switch(this.get("directionsLengthUnits")){case u.KILOMETERS:y.set(this._useKilometersNode,"checked",!0);y.set(this._useMilesNode,"checked",!1);break;case u.MILES:y.set(this._useKilometersNode,"checked",!1),y.set(this._useMilesNode,"checked",!0)}this._showMilesKilometersOption();this._showClearButton()},_optionsMenu:function(){this._useTrafficItemNode&&x.set(this._useTrafficItemNode,
"display",this.get("showTrafficOption")?"block":"none");this._returnToStartItemNode&&x.set(this._returnToStartItemNode,"display",this.get("showReturnToStartOption")?"block":"none");this._findOptimalOrderItemNode&&x.set(this._findOptimalOrderItemNode,"display",this.get("showOptimalRouteOption")&&3<this._getStopCount()?"block":"none");this.stops.length>=this.get("minStops")?r.add(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass):(r.remove(this._widgetContainer,this._css.stopsOptionsOptionsEnabledClass),
this._optionsMenuNode&&"block"===x.get(this._optionsMenuNode,"display")&&this._toggleOptionsMenu(),this._configureRouteOptions())},_stopsRemovable:function(){2<this._dnd.getAllNodes().length-this._getWaypointCount()?r.add(this._widgetContainer,this._css.stopsRemovableClass):r.remove(this._widgetContainer,this._css.stopsRemovableClass)},_checkMaxStops:function(){this.set("maxStopsReached",this.stops.length>=this.maxStops);this._showAddDestination()},_updateThemeWatch:function(a,b,c){r.remove(this.domNode,
b);r.add(this.domNode,c)},_toggleOptionsMenu:function(){this._optionsMenuNode&&("block"===x.get(this._optionsMenuNode,"display")?(x.set(this._optionsMenuNode,"display","none"),this._optionsButtonNode.innerHTML=l.widgets.directions.showOptions):(x.set(this._optionsMenuNode,"display","block"),this._optionsButtonNode.innerHTML=l.widgets.directions.hideOptions))},_showToolbar:function(){r[this.stops.length<this.maxStops&&this.canModifyStops||this.canModifyWaypoints?"add":"remove"].call(t,this._widgetContainer,
this._css.addStopsClass)},_showAddDestination:function(){this._showToolbar();this._addDestinationNode.style.display=this.stops.length<this.maxStops&&this.canModifyStops?"inline":"none"},_showMapClickActiveButton:function(){this._showToolbar();this._activateButtonNode.style.display=this.canModifyStops||this.canModifyWaypoints?"inline-block":"none"},_getAbsoluteUrl:function(a){a=z.toUrl(a);return/^https?\:/i.test(a)?a:/^\/\//i.test(a)?window.location.protocol+a:/^\//i.test(a)?window.location.protocol+
"//"+window.location.host+a:a},_getManeuverImage:function(a){return a?"esriDMTStop"===a||"esriDMTDepart"===a?"":this._getAbsoluteUrl("./images/Directions/maneuvers/"+a+".png"):""},_loadPrintDirections:function(a){var b=this.get("printTemplate"),c=new p;this.directionsLengthUnits!==this.routeParams.directionsLengthUnits?this.getDirections().then(c.resolve):c.resolve();c.then(f.hitch(this,function(){if(!b){var c=this._getAbsoluteUrl("./css/Directions.css"),e=this._getAbsoluteUrl("./css/DirectionsPrint.css"),
g=this._getAbsoluteUrl("./images/Directions/print-logo.png"),h;h=ba.isBodyLtr()?"ltr":"rtl";b="";b+="\x3c!DOCTYPE HTML\x3e";b+='\x3chtml lang\x3d"en" class\x3d"'+this.get("theme")+'" dir\x3d"'+h+'"\x3e';b+="\x3chead\x3e";b+='\x3cmeta charset\x3d"utf-8"\x3e';b+='\x3cmeta http-equiv\x3d"X-UA-Compatible" content\x3d"IE\x3dEdge,chrome\x3d1"\x3e';b+="\x3ctitle\x3e"+this.get("directions").routeName+"\x3c/title\x3e";b+='\x3clink rel\x3d"stylesheet" media\x3d"screen" type\x3d"text/css" href\x3d"'+c+'" /\x3e';
b+='\x3clink rel\x3d"stylesheet" media\x3d"print" type\x3d"text/css" href\x3d"'+e+'" /\x3e';b+="\x3c/head\x3e";b+='\x3cbody class\x3d"'+this._css.esriPrintPageClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.esriPrintBarClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.esriCloseButtonClass+'" title\x3d"'+l.common.close+'" onclick\x3d"window.close();"\x3e'+l.common.close+"\x3c/div\x3e";b+='\x3cdiv id\x3d"printButton" class\x3d"'+this._css.esriPrintButtonClass+'" title\x3d"'+l.widgets.directions.print+
'" onclick\x3d"window.print();"\x3e'+l.widgets.directions.print+"\x3c/div\x3e";b+="\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.esriPrintMainClass+'"\x3e';b+='\x3cdiv class\x3d"'+this._css.esriPrintHeaderClass+'"\x3e';b+='\x3cimg class\x3d"'+this._css.esriPrintLogoClass+'" src\x3d"'+g+'" /\x3e';b+='\x3cdiv class\x3d"'+this._css.esriPrintNameClass+'"\x3e'+this.get("directions").routeName+"\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.esriPrintLengthClass+'"\x3e'+this._formatDistance(this.get("directions").totalLength,
!0)+" \x26middot; "+this._formatTime(this.get("directions").totalTime)+"\x3c/div\x3e";a&&(b+='\x3cdiv id\x3d"divMap" class\x3d"esriPrintMap esriPrintWait"\x3e\x3c/div\x3e',b+='\x3chr class\x3d"esriNoPrint"/\x3e');b+='\x3cdiv id\x3d"print_helper"\x3e\x3c/div\x3e';b+='\x3ctextarea onkeyup\x3d"document.getElementById(\'print_helper\').innerHTML\x3dthis.value;" id\x3d"print_area" class\x3d"'+this._css.esriPrintNotesClass+'" placeholder\x3d"'+l.widgets.directions.printNotes+'"\x3e\x3c/textarea\x3e';b+=
'\x3cdiv class\x3d"'+this._css.clearClass+'"\x3e\x3c/div\x3e';b+="\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.esriPrintDirectionsClass+'"\x3e';b+="\x3ctable\x3e";b+="\x3ctbody\x3e";w.forEach(this.get("directions").features,f.hitch(this,function(a,c){var d=this.get("directions").strings[c]||[],e;if("esriDMTDepart"===a.attributes.maneuverType||"esriDMTStop"===a.attributes.maneuverType)for(e=0;e<this.stops.length;e++)this.stops[e]&&this.stops[e].name&&d.push({string:this.stops[e].name});if(d){var f=
a.attributes.text;for(e=0;e<d.length;e++)f=this._boldText(f,d[e].string);a.attributes.formattedText=f}else a.attributes.formattedText=a.attributes.text;d="";this.get("directions").features.length===c+1&&(d=this._css.routeLastClass);a.attributes&&(a.attributes.step=c+1);b+='\x3ctr class\x3d"'+d+'"\x3e';b+='\x3ctd class\x3d"'+this._css.routeIconColumnClass+'"\x3e';d=this._getManeuverImage(a.attributes.maneuverType);e=this._getLetter(a._associatedStop);d?b+='\x3cimg src\x3d"'+d+'" /\x3e':e&&(b+='\x3cdiv class\x3d"'+
this._css.esriPrintStopLabelClass+'"\x3e',b+=e,b+="\x3c/div\x3e");b+="\x3c/td\x3e";b+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';b+="\x3cdiv\x3e\x3cstrong\x3e"+L.format(a.attributes.step)+".\x3c/strong\x3e "+a.attributes.formattedText+"\x3c/div\x3e";b+="\x3c/td\x3e";b+='\x3ctd class\x3d"'+this._css.routeTextColumnClass+'"\x3e';d=this._formatTime(a.attributes.time);d=this._formatDistance(a.attributes.length,!1)+(d?" \x26middot; "+d:"");b+='\x3cdiv class\x3d"'+this._css.routeLengthClass+
'"\x3e'+d+"\x3c/div\x3e";b+="\x3c/td\x3e";b+="\x3c/tr\x3e"}));b+="\x3c/tbody\x3e";b+="\x3c/table\x3e";b+="\x3c/div\x3e";b+='\x3cdiv class\x3d"'+this._css.esriPrintFooterClass+'"\x3e';b+="\x3cp\x3e"+l.widgets.directions.printDisclaimer+"\x3c/p\x3e";b+="\x3c/div\x3e";b+="\x3c/div\x3e";b+="\x3c/body\x3e";b+="\x3c/html\x3e"}this._printWindow.document.open("text/html","replace");this._printWindow.document.write(b);this._printWindow.document.close()}))},_printDirections:function(){var a=screen.width/2,
b=screen.height/1.5,a="toolbar\x3dno, location\x3dno, directories\x3dno, status\x3dyes, menubar\x3dno, scrollbars\x3dyes, resizable\x3dyes, width\x3d"+a+", height\x3d"+b+", top\x3d"+(screen.height/2-b/2)+", left\x3d"+(screen.width/2-a/2);this.get("printPage")?(window.directions=this.get("directions"),window.open(this.get("printPage"),"directions_widget_print",a,!0)):(this._printWindow=window.open("","directions_widget_print",a,!0),this._loadPrintDirections(!!this._printService),this._printService&&
z(["dojo/_base/window"],f.hitch(this,function(a){this.zoomToFullRoute().then(f.hitch(this,function(){this._printService.execute(this._printParams,f.hitch(this,function(b){a.withDoc(this._printWindow.document,function(){var a=U.byId("divMap");a&&(r.remove(a,"esriPrintWait"),r.add(a,"esriPageBreak"),t.create("img",{src:b.url,"class":"esriPrintMapImg"},a))})}),f.hitch(this,function(b){a.withDoc(this._printWindow.document,function(){var a=U.byId("divMap");a&&r.remove(a,"esriPrintWait")});console.error("Error while calling print service:\n "+
b)}))}))})))}});aa("extend-esri")&&f.setObject("dijit.Directions",K,ea);return K});